<!DOCTYPE html>
<html lang="zh-Hans" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Page Fault | Blog</title>
    <meta name="description" content="Linux kernel å†…æ ¸ä»£ç åˆ†æï¼ŒåŸç†è¯¦è§£">
    <meta name="generator" content="VitePress v2.0.0-alpha.13">
    <link rel="preload stylesheet" href="/blog/assets/style.Cg8D8EfQ.css" as="style">
    <link rel="preload stylesheet" href="/blog/vp-icons.css" as="style">
    <script type="module" src="/blog/assets/chunks/metadata.e2231c71.js"></script>
    <script type="module" src="/blog/assets/app.DgFSTuZM.js"></script>
    <link rel="preload" href="/blog/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/blog/assets/chunks/theme.3WDp7bvS.js">
    <link rel="modulepreload" href="/blog/assets/chunks/framework.CdzZEkix.js">
    <link rel="modulepreload" href="/blog/assets/mm_pagefault.md.B-fbOobf.lean.js">
    <link rel="icon" type="image/svg+xml" href="/blog/linux.svg">
    <link rel="icon" type="image/png" href="/blog/linux-32x32.png">
    <meta name="theme-color" content="#5f67ee">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:title" content="Page Fault | Blog">
    <meta property="og:site_name" content="Linux kernel å†…æ ¸ä»£ç åˆ†æï¼ŒåŸç†è¯¦è§£">
    <meta property="og:url" content="https://hyuuko.vercel.app">
    <meta name="google-site-verification" content="OMML6xlbLb2Asitovo85pbOZGTvYoWaYWYW3ps7083s">
    <meta name="msvalidate.01" content="E3B108A75866D6C18B16BE35E14DE820">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-304c8b69><!--[--><!--]--><!--[--><span tabindex="-1" data-v-10d4d845></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-10d4d845>Skip to content</a><!--]--><!----><header class="VPNav" data-v-304c8b69 data-v-d5bf7c8e><div class="VPNavBar" data-v-d5bf7c8e data-v-8eab0e6d><div class="wrapper" data-v-8eab0e6d><div class="container" data-v-8eab0e6d><div class="title" data-v-8eab0e6d><div class="VPNavBarTitle has-sidebar" data-v-8eab0e6d data-v-d4488dd0><a class="title" href="/blog/" data-v-d4488dd0><!--[--><!--]--><!--[--><img class="VPImage logo" src="/blog/linux.svg" width="20" height="20" alt data-v-ab19afbb><!--]--><span data-v-d4488dd0>Blog</span><!--[--><!--]--></a></div></div><div class="content" data-v-8eab0e6d><div class="content-body" data-v-8eab0e6d><!--[--><!--]--><div class="VPNavBarSearch search" data-v-8eab0e6d><!--[--><!----><div id="local-search"><button type="button" aria-label="æœç´¢æ–‡æ¡£" aria-keyshortcuts="/ control+k meta+k" class="DocSearch DocSearch-Button"><span class="DocSearch-Button-Container"><span class="vpi-search DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">æœç´¢æ–‡æ¡£</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key"></kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-8eab0e6d data-v-020be4db><span id="main-nav-aria-label" class="visually-hidden" data-v-020be4db> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/blog/mm/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>å†…å­˜ç®¡ç†</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/net/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>ç½‘ç»œ</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/storage/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>å­˜å‚¨</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/process/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>è¿›ç¨‹</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/sched/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>è°ƒåº¦</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/irq/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>ä¸­æ–­</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/arch/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>ä½“ç³»ç»“æ„</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/debug/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>è°ƒè¯•</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/virtualization/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>è™šæ‹ŸåŒ–</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-020be4db data-v-d8fae6e2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-d8fae6e2><span class="text" data-v-d8fae6e2><!----><span data-v-d8fae6e2>æ‚é¡¹</span><span class="vpi-chevron-down text-icon" data-v-d8fae6e2></span></span></button><div class="menu" data-v-d8fae6e2><div class="VPMenu" data-v-d8fae6e2 data-v-fcd1d7a8><div class="items" data-v-fcd1d7a8><!--[--><!--[--><div class="VPMenuLink" data-v-fcd1d7a8 data-v-acfa8338><a class="VPLink link" href="/blog/other/index" data-v-acfa8338><!--[--><span data-v-acfa8338>å…¶ä»–</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fcd1d7a8 data-v-acfa8338><a class="VPLink link" href="/blog/init/index" data-v-acfa8338><!--[--><span data-v-acfa8338>åˆå§‹åŒ–</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fcd1d7a8 data-v-acfa8338><a class="VPLink link" href="/blog/pm/index" data-v-acfa8338><!--[--><span data-v-acfa8338>ç”µæºç®¡ç†</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-8eab0e6d data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-8eab0e6d data-v-ef6192dc data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/hyuuko1/blog" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-8eab0e6d data-v-600b50c9 data-v-d8fae6e2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-d8fae6e2><span class="vpi-more-horizontal icon" data-v-d8fae6e2></span></button><div class="menu" data-v-d8fae6e2><div class="VPMenu" data-v-d8fae6e2 data-v-fcd1d7a8><!----><!--[--><!--[--><!----><div class="group" data-v-600b50c9><div class="item appearance" data-v-600b50c9><p class="label" data-v-600b50c9>ä¸»é¢˜</p><div class="appearance-action" data-v-600b50c9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-600b50c9 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-600b50c9><div class="item social-links" data-v-600b50c9><div class="VPSocialLinks social-links-list" data-v-600b50c9 data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/hyuuko1/blog" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-8eab0e6d data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-8eab0e6d><div class="divider-line" data-v-8eab0e6d></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-304c8b69 data-v-5ae341c6><div class="container" data-v-5ae341c6><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-5ae341c6><span class="vpi-align-left menu-icon" data-v-5ae341c6></span><span class="menu-text" data-v-5ae341c6>èœå•</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-5ae341c6 data-v-e28a51a6><button data-v-e28a51a6>å›åˆ°é¡¶éƒ¨</button><!----></div></div></div><aside class="VPSidebar" data-v-304c8b69 data-v-46b39de1><div class="curtain" data-v-46b39de1></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-46b39de1><span class="visually-hidden" id="sidebar-aria-label" data-v-46b39de1> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å‰è¨€</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/update" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>æ›´æ–°è®¡åˆ’</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/gorman_book" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ UTLVMM (Linux 2.6)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>æè¿°ç‰©ç†å†…å­˜</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/layout" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>å†…å­˜å¸ƒå±€</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/e820" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>e820</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/node" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>node</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/zone" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>zone</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/folio" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>struct page/folio è¯¦è§£</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/vmemmap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>pfn_to_page() çš„åŸç†ï¼šmem_section ä¸ vmemmap</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible has-active" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>è™šæ‹Ÿå†…å­˜æ˜ å°„</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/rmap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>rmap åå‘æ˜ å°„</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/vma" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>vma</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/mmap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>mmap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/vmap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>vmap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/kmap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>kmap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/pagefault" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>page fault</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/page_table" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ page table</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/ioremap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ ioremap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/fixmap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ fixmap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/highmem" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ highmem é«˜ç«¯å†…å­˜</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/cow" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ CoW (Copy on Write)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/uffd" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ UFFD (userfaultfd)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/shmem" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ share memory</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/tlb" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ tlb</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/dma_buf" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ dma-buf</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å†…å­˜åˆ†é…</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/buddy" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Buddy System: é¡µé¢åˆ†é…å™¨</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/vmalloc" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>vmalloc: ä¸è¿ç»­ç‰©ç†å†…å­˜åˆ†é…</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/percpu" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>per-cpu é™æ€å’ŒåŠ¨æ€åˆ†é…</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/oom" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>OOM (Out Of Memory)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/slub" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>SLUB å†…å­˜åˆ†é…å™¨</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/cma" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>CMA è¿ç»­å†…å­˜åˆ†é…å™¨</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/memblock" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ æ—©æœŸå†…å­˜åˆ†é…å™¨ memblock</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/gfp" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>GFP (Get Free Page)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å¤§é¡µ</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/hugetlb" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>HugeTLB æ ‡å‡†å¤§é¡µ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/thp" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>THP (Transparent Huge Page) é€æ˜å¤§é¡µ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/mthp" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>mTHP (Multi-size Transparent Huge Page)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å†…å­˜å›æ”¶</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/reclaim/reclaim" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>å†…å­˜å›æ”¶(åºŸå¼ƒ)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/reclaim/basic" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>å†…å­˜å›æ”¶åŸºç¡€</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/reclaim/lru" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>LRU</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/reclaim/mglru" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>MGLRU</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/reclaim/workingset" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>workingset</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/reclaim/swap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>swap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/mlock" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>mlock</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å†…å­˜åç¢ç‰‡</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/anti-fragmentation" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ å†…å­˜åç¢ç‰‡</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/compaction" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ å†…å­˜è§„æ•´</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/page_migration" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>é¡µé¢è¿ç§»</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å…¶ä»–</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/gup" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>GUP (Get User Page)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/pageflags" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>pageflags</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/madvise" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ madvise</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/ksm" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ KSM (Kernel Samepage Merging)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/hotplug" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ hotplug</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/virtio_mem" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ virtio mem</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/virtio_pmem" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ virtio pmem</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/virtio_balloon" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ virtio balloon</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Non-Uniform Memory Access architecture</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/mempolicy" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ Memory Policy å†…å­˜ç­–ç•¥</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å†…å­˜ç®¡ç†ä¸æ–‡ä»¶ç³»ç»Ÿ</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/storage/readahead" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ readahead é¢„è¯»</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/storage/pagecache" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ page cache</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/storage/page_writeback" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ page writeback</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/storage/tmpfs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ tmpfs</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/storage/ramfs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ ramfs</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-304c8b69 data-v-2652e39a><div class="VPDoc has-sidebar has-aside" data-v-2652e39a data-v-d668f7cc><!--[--><!--]--><div class="container" data-v-d668f7cc><div class="aside" data-v-d668f7cc><div class="aside-curtain" data-v-d668f7cc></div><div class="aside-container" data-v-d668f7cc><div class="aside-content" data-v-d668f7cc><div class="VPDocAside" data-v-d668f7cc data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-c8b19031><div class="content" data-v-c8b19031><div class="outline-marker" data-v-c8b19031></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-c8b19031>ç›®å½•</div><ul class="VPDocOutlineItem root" data-v-c8b19031 data-v-63c57e50><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d668f7cc><div class="content-container" data-v-d668f7cc><!--[--><!--]--><main class="main" data-v-d668f7cc><div style="position:relative;" class="vp-doc _blog_mm_pagefault external-link-icon-enabled" data-v-d668f7cc><div><h1 id="page-fault" tabindex="-1">Page Fault <a class="header-anchor" href="#page-fault" aria-label="Permalink to â€œPage Faultâ€">â€‹</a></h1><h2 id="å‚è€ƒ" tabindex="-1">å‚è€ƒ <a class="header-anchor" href="#å‚è€ƒ" aria-label="Permalink to â€œå‚è€ƒâ€">â€‹</a></h2><ul><li><a href="https://zhuanlan.zhihu.com/p/658583497" target="_blank" rel="noreferrer">Linux page fault - çŸ¥ä¹</a></li><li><a href="https://zhuanlan.zhihu.com/p/669335977" target="_blank" rel="noreferrer">Linux anonymous page fault - çŸ¥ä¹</a></li><li><a href="https://zhuanlan.zhihu.com/p/674910418" target="_blank" rel="noreferrer">Linux file-backed page fault - çŸ¥ä¹</a></li><li><a href="https://zhuanlan.zhihu.com/p/673410655" target="_blank" rel="noreferrer">ä¸€æ–‡èŠé€ Linux ç¼ºé¡µå¼‚å¸¸çš„å¤„ç† â€”â€” å›¾è§£ Page Faults - çŸ¥ä¹</a></li><li>ã€ŠLinux å†…æ ¸æ·±åº¦è§£æã€‹3.14 é¡µé”™è¯¯å¼‚å¸¸å¤„ç†</li></ul><h2 id="æ¦‚è§ˆ" tabindex="-1">æ¦‚è§ˆ <a class="header-anchor" href="#æ¦‚è§ˆ" aria-label="Permalink to â€œæ¦‚è§ˆâ€">â€‹</a></h2><p>é¡µé”™è¯¯å¼‚å¸¸æœ‰å‡ ç§æƒ…å†µï¼š</p><ol><li>ç¼ºé¡µå¼‚å¸¸ï¼šè™šæ‹Ÿé¡µæ²¡æœ‰æ˜ å°„åˆ°ç‰©ç†é¡µ <ol><li>è®¿é—®ç”¨æˆ·æ ˆçš„æ—¶å€™ï¼Œè¶…å‡ºäº†å½“å‰ç”¨æˆ·æ ˆçš„èŒƒå›´ï¼Œéœ€è¦æ‰©å¤§ç”¨æˆ·æ ˆã€‚</li><li>å½“è¿›ç¨‹ç”³è¯·è™šæ‹Ÿå†…å­˜åŒºåŸŸçš„æ—¶å€™ï¼Œé€šå¸¸æ²¡æœ‰åˆ†é…ç‰©ç†é¡µï¼Œè¿›ç¨‹ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™è§¦å‘é¡µé”™è¯¯å¼‚å¸¸ã€‚</li><li>å†…å­˜ä¸è¶³çš„æ—¶å€™ï¼Œå†…æ ¸æŠŠè¿›ç¨‹çš„åŒ¿åé¡µæ¢å‡ºåˆ°äº¤æ¢åŒºã€‚</li><li>ä¸€ä¸ªæ–‡ä»¶é¡µè¢«æ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå†…å­˜ä¸è¶³çš„æ—¶å€™ï¼Œå†…æ ¸å›æ”¶è¿™ä¸ªæ–‡ä»¶é¡µï¼Œåœ¨è¿›ç¨‹çš„é¡µè¡¨ä¸­åˆ é™¤è¿™ä¸ªæ–‡ä»¶é¡µçš„æ˜ å°„ã€‚</li><li>ç¨‹åºé”™è¯¯ï¼Œè®¿é—®æ²¡æœ‰åˆ†é…ç»™è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸã€‚ <br>å‰ 4 ç§æƒ…å†µï¼Œå¦‚æœé¡µé”™è¯¯å¼‚å¸¸å¤„ç†ç¨‹åºæˆåŠŸåœ°æŠŠè™šæ‹Ÿé¡µæ˜ å°„åˆ°ç‰©ç†é¡µï¼Œå¤„ç†ç¨‹åºè¿”å›åï¼Œå¤„ç†å™¨é‡æ–°æ‰§è¡Œè§¦å‘å¼‚å¸¸çš„æŒ‡ä»¤ã€‚ <br>ç¬¬ 5 ç§æƒ…å†µï¼Œé¡µé”™è¯¯å¼‚å¸¸å¤„ç†ç¨‹åºå°†ä¼šå‘é€ SIGSEGV ä¿¡å·ä»¥æ€æ­»è¿›ç¨‹ã€‚</li></ol></li><li>æ²¡æœ‰è®¿é—®æƒé™ <ol><li>å¯èƒ½æ˜¯è½¯ä»¶æœ‰æ„é€ æˆçš„ï¼Œå…¸å‹çš„ä¾‹å­æ˜¯å†™æ—¶å¤åˆ¶ï¼ˆCopy on Write ï¼Œ CoWï¼‰ã€‚</li><li>ç¨‹åºé”™è¯¯ï¼Œä¾‹å¦‚è¯•å›¾å†™åªè¯»çš„ä»£ç æ®µæ‰€åœ¨çš„ç‰©ç†é¡µã€‚é¡µé”™è¯¯å¼‚å¸¸å¤„ç†ç¨‹åºå°†ä¼šå‘é€ SIGSEGV ä¿¡å·ä»¥æ€æ­»è¿›ç¨‹ã€‚</li></ol></li></ol><p>é¡µè¡¨é¡¹ä¸å­˜åœ¨çš„æƒ…å†µï¼š</p><table tabindex="0"><thead><tr><th></th><th>åœºæ™¯</th><th>è¯» (é¡µè¡¨é¡¹ä¸å­˜åœ¨)</th><th>å†™ (é¡µè¡¨é¡¹ä¸å­˜åœ¨)</th></tr></thead><tbody><tr><td>ç§æœ‰åŒ¿å</td><td></td><td><code>do_anonymous_page</code></td><td><code>do_anonymous_page</code></td></tr><tr><td>å…±äº«åŒ¿å</td><td></td><td><code>do_read_fault</code></td><td><code>do_shared_fault</code></td></tr><tr><td>å…±äº«æ–‡ä»¶</td><td></td><td><code>do_read_fault</code></td><td><code>do_shared_fault</code></td></tr><tr><td>ç§æœ‰æ–‡ä»¶</td><td>åŠ¨æ€é“¾æ¥åº“</td><td><code>do_read_fault</code></td><td><code>do_cow_fault</code></td></tr></tbody></table><p>æ³¨æ„ï¼šç§æœ‰æ–‡ä»¶æ˜ å°„é¡µåœ¨å†™å¤åˆ¶åï¼Œæˆäº†è¿›ç¨‹çš„ç§æœ‰åŒ¿åé¡µï¼Œå’Œæ–‡ä»¶è„±ç¦»å…³ç³»ï¼Œä¸ä¼š write backã€‚</p><p>é¡µè¡¨é¡¹å­˜åœ¨çš„æƒ…å†µï¼š</p><ul><li>å¦‚æœé¡µä¸åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œåˆ™è¯´æ˜åœ¨ swap ä¸­ï¼Œ<code>do_swap_page</code>ã€‚</li><li>å¦‚æœé¡µåœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œè€Œä¸” pte é‡Œæ²¡å†™æƒé™ï¼ˆvmf-&gt;flags é‡Œç”±ï¼‰ï¼Œåˆ™è¯´æ˜æ˜¯ fork çš„ç§æœ‰é¡µ CoW <code>do_wp_page</code>ã€‚</li></ul><h2 id="å¼‚å¸¸å¤„ç†ç¨‹åº" tabindex="-1">å¼‚å¸¸å¤„ç†ç¨‹åº <a class="header-anchor" href="#å¼‚å¸¸å¤„ç†ç¨‹åº" aria-label="Permalink to â€œå¼‚å¸¸å¤„ç†ç¨‹åºâ€">â€‹</a></h2><h3 id="arm-æ¶æ„" tabindex="-1">ARM æ¶æ„ <a class="header-anchor" href="#arm-æ¶æ„" aria-label="Permalink to â€œARM æ¶æ„â€">â€‹</a></h3><p>å¦‚æœæ²¡æœ‰å‘½ä¸­ TLB è¡¨é¡¹ï¼Œå†…å­˜ç®¡ç†å•å…ƒå°†ä¼šæŸ¥è¯¢å†…å­˜ä¸­çš„é¡µè¡¨ï¼Œç§°ä¸ºè½¬æ¢è¡¨éå†ï¼ˆtranslation table walkï¼‰ï¼Œåˆ†ä¸¤ç§æƒ…å†µã€‚</p><ol><li>å¦‚æœè™šæ‹Ÿåœ°å€çš„é«˜ 16 ä½å…¨éƒ¨æ˜¯ 1ï¼Œè¯´æ˜æ˜¯å†…æ ¸è™šæ‹Ÿåœ°å€ï¼Œåº”è¯¥æŸ¥è¯¢å†…æ ¸çš„é¡µè¡¨ï¼Œä»å¯„å­˜å™¨ TTBR1_EL1 å–å†…æ ¸çš„é¡µå…¨å±€ç›®å½•çš„ç‰©ç†åœ°å€ã€‚</li><li>å¦‚æœè™šæ‹Ÿåœ°å€çš„é«˜ 16 ä½å…¨éƒ¨æ˜¯ 0ï¼Œè¯´æ˜æ˜¯ç”¨æˆ·è™šæ‹Ÿåœ°å€ï¼Œåº”è¯¥æŸ¥è¯¢è¿›ç¨‹çš„é¡µè¡¨ï¼Œä»å¯„å­˜å™¨ TTBR0_EL1 å–è¿›ç¨‹çš„é¡µå…¨å±€ç›®å½•çš„ç‰©ç†åœ°å€ã€‚</li></ol><h3 id="x86-æ¶æ„" tabindex="-1">x86 æ¶æ„ <a class="header-anchor" href="#x86-æ¶æ„" aria-label="Permalink to â€œx86 æ¶æ„â€">â€‹</a></h3><p>ç”¨çš„å±…ç„¶æ˜¯ä¸­æ–­é—¨ï¼Œè€Œéé™·é˜±é—¨ï¼ï¼ å› æ­¤å‘ç”Ÿ page fault æ—¶ï¼ŒCPU ä¼šè‡ªåŠ¨æ¸… RFLAGS.IF ç¦æœ¬åœ°ä¸­æ–­ã€‚</p><p>ä» git history ä¸­æ‰¾ä¸å‡ºåŸå› ï¼ŒDeepSeek ç»™å‡ºçš„è§£é‡Šæ˜¯ï¼š Page Fault çš„å¤„ç†å¯èƒ½æ¶‰åŠä¿®æ”¹é¡µè¡¨ã€åˆ†é…ç‰©ç†å†…å­˜ã€è°ƒæ•´è¿›ç¨‹åœ°å€ç©ºé—´ç­‰æ“ä½œã€‚è¿™äº›æ“ä½œéœ€è¦ä¿è¯åŸå­æ€§ï¼Œé¿å…è¢«å…¶ä»–ä¸­æ–­ï¼ˆå¦‚æ—¶é’Ÿä¸­æ–­ã€è®¾å¤‡ä¸­æ–­ï¼‰æ‰“æ–­ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æ•°æ®ç«äº‰æˆ–çŠ¶æ€ä¸ä¸€è‡´ã€‚ è‹¥å¤„ç†ç¨‹åºéœ€è¦ç¡çœ ï¼ˆå¦‚è§¦å‘ I/O æ“ä½œæˆ–ç­‰å¾…å†…å­˜åˆ†é…ï¼‰ï¼Œå†…æ ¸ä»å¯æ˜¾å¼è°ƒç”¨ <code>local_irq_enable()</code> ä¸´æ—¶å¼€å¯ä¸­æ–­ã€‚ ä¾‹å¦‚ï¼Œå¤„ç†ç”¨æˆ·æ€ç¼ºé¡µæ—¶ï¼Œå¯èƒ½å› ç­‰å¾…ç£ç›˜ I/Oï¼ˆå¦‚æ¢é¡µï¼‰è€Œå…è®¸ä¸­æ–­ã€‚</p><p>åœ¨<a href="https://lore.kernel.org/all/20240125173457.1281880-1-torvalds@linux-foundation.org/" target="_blank" rel="noreferrer">è¿™ä¸ª patch</a> åï¼Œåœ¨ <code>do_user_addr_fault()</code> å¤„ç†è®¿é—®ç”¨æˆ·è™šæ‹Ÿåœ°å€å¼‚å¸¸æ—¶ï¼Œä¼š <code>local_irq_enable()</code> å¼€å¯ä¸­æ–­ã€‚åœ¨æ­¤ä¹‹å‰æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* å¦‚æœæ˜¯ç”¨æˆ·æ€è®¿é—®ç”¨æˆ·è™šæ‹Ÿåœ°å€å¼‚å¸¸ï¼Œå¼€ä¸­æ–­ */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user_mode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(regs)) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	local_irq_enable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FAULT_FLAG_USER;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/* å¦‚æœæ˜¯å†…æ ¸æ€è®¿é—®ç”¨æˆ·è™šæ‹Ÿåœ°å€å¼‚å¸¸ã€‚å¦‚æœäº§ç”Ÿå¼‚å¸¸æ—¶æ˜¯å¼€ä¸­æ–­çš„ï¼Œåˆ™å¼€ */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (regs-&gt;flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> X86_EFLAGS_IF)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		local_irq_enable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>æˆ‘çš„æƒ³æ³•æ˜¯ï¼šç›´æ¥åˆ¤æ–­æ˜¯å¦äº§ç”Ÿå¼‚å¸¸æ—¶æ˜¯å¼€ä¸­æ–­çš„ä¸å°±è¡Œäº†å—ï¼Ÿç”¨æˆ·æ€è‚¯å®šå¼€ç€ä¸­æ–­çš„å•Šã€‚ ä½†æ˜¯ï¼Œæˆ‘åˆå‘ç°äº†è¿™ä¸ª commit: <a href="https://github.com/torvalds/linux/commit/891cffbd6bcba26409869c19c07ecd4bfc0c2460" target="_blank" rel="noreferrer">https://github.com/torvalds/linux/commit/891cffbd6bcba26409869c19c07ecd4bfc0c2460</a> éš¾é“ç”¨æˆ·æ€ä¹Ÿå¯ä»¥å…³ä¸­æ–­ï¼Ÿæ˜¯çš„ï¼åœ¨ Linux 5.5 ä¹‹å‰å¯ä»¥ç”¨ <a href="https://man7.org/linux/man-pages/man2/iopl.2.html" target="_blank" rel="noreferrer">iopl(2)</a> å…³é—­ä¸­æ–­ï¼</p><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> __initconst </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> idt_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> early_pf_idts[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/* INTG: Interrupt gate */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	INTG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(X86_TRAP_PF,		asm_exc_page_fault),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* ä¸ç®¡æ˜¯åœ¨ç”¨æˆ·æ€è¿˜æ˜¯å†…æ ¸æ€è§¦å‘ page fault éƒ½æ˜¯è¿™ä¸ªå¼‚å¸¸å¤„ç†ç¨‹åº */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">asm_exc_page_fault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  handle_page_fault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* è®¿é—®å†…æ ¸è™šæ‹Ÿåœ°å€æ—¶ page fault è¿™ç§æƒ…å†µéå¸¸å°‘è§ */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unlikely</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fault_in_kernel_space</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(address)))</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      do_kern_addr_fault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(regs, error_code, address);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      do_user_addr_fault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(regs, error_code, address);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        local_irq_enable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        /* å¦‚æœå‘ç”Ÿåœ¨ç”¨æˆ·æ€ï¼Œå°±åŠ ä¸Šè¿™ä¸ª flag */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user_mode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(regs)) flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FAULT_FLAG_USER;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vma </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> lock_vma_under_rcu</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mm, address);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        /* å¦‚æœæ˜¯æƒé™é”™è¯¯ */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unlikely</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">access_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(error_code, vma)))</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          bad_area_access_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(regs, error_code, address, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, vma);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/* å¤„ç† */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        fault </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handle_mm_fault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vma, address, flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FAULT_FLAG_VMA_LOCK, regs);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        /* å¦‚æœæ— éœ€ retryï¼Œå°± goto done ç»“æŸå¤„ç†æµç¨‹ */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fault </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> VM_FAULT_RETRY)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> done;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        retry:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          /* é‡è¯• */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          fault </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handle_mm_fault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vma, address, flags, regs);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      local_irq_disable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="ç”¨æˆ·ç©ºé—´é¡µé”™è¯¯å¼‚å¸¸" tabindex="-1">ç”¨æˆ·ç©ºé—´é¡µé”™è¯¯å¼‚å¸¸ <a class="header-anchor" href="#ç”¨æˆ·ç©ºé—´é¡µé”™è¯¯å¼‚å¸¸" aria-label="Permalink to â€œç”¨æˆ·ç©ºé—´é¡µé”™è¯¯å¼‚å¸¸â€">â€‹</a></h2><p>ä»å‡½æ•° <code>handle_mm_fault()</code> å¼€å§‹çš„éƒ¨åˆ†æ˜¯æ‰€æœ‰å¤„ç†å™¨æ¶æ„å…±ç”¨çš„éƒ¨åˆ†ï¼Œè´Ÿè´£å¤„ç†ç”¨æˆ·ç©ºé—´çš„é¡µé”™è¯¯å¼‚å¸¸ã€‚ç”¨æˆ·ç©ºé—´é¡µé”™è¯¯å¼‚å¸¸æ˜¯æŒ‡è¿›ç¨‹è®¿é—®ç”¨æˆ·è™šæ‹Ÿåœ°å€ç”Ÿæˆçš„é¡µé”™è¯¯å¼‚å¸¸ï¼Œåˆ†ä¸¤ç§æƒ…å†µã€‚</p><ol><li>è¿›ç¨‹åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹è®¿é—®ç”¨æˆ·è™šæ‹Ÿåœ°å€ï¼Œç”Ÿæˆé¡µé”™è¯¯å¼‚å¸¸ã€‚</li><li>è¿›ç¨‹åœ¨å†…æ ¸æ¨¡å¼ä¸‹è®¿é—®ç”¨æˆ·è™šæ‹Ÿåœ°å€ï¼Œç”Ÿæˆé¡µé”™è¯¯å¼‚å¸¸ã€‚è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿›å…¥å†…æ ¸æ¨¡å¼ï¼Œç³»ç»Ÿè°ƒç”¨ä¼ å…¥ç”¨æˆ·ç©ºé—´çš„ç¼“å†²åŒºï¼Œè¿›ç¨‹åœ¨å†…æ ¸æ¨¡å¼ä¸‹è®¿é—®ç”¨æˆ·ç©ºé—´çš„ç¼“å†²åŒºã€‚</li></ol><p>ç®€è¿° <code>handle_mm_fault()</code> æµç¨‹ï¼š</p><ol><li>å¦‚æœ pgd p4d pud é¡µè¡¨ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºã€‚</li><li>å¦‚æœ pud é¡µè¡¨é¡¹ç©ºçš„ï¼Œåˆ™å°è¯•é€æ˜å¤§é¡µã€‚æˆåŠŸåˆ™è¿”å›ã€‚</li><li>å¦‚æœ pud é¡µè¡¨é¡¹ä¸æ˜¯ç©ºçš„ï¼Œå¹¶ä¸”æ˜¯é€æ˜å¤§é¡µï¼Œè¦ä¹ˆæ˜¯å› ä¸º CoWï¼Œè¦ä¹ˆæ˜¯å› ä¸ºè¦è½¯ä»¶æ ‡è®° access dirty ä½ã€‚è¿”å›ã€‚ XXX æ²¡æœ‰åˆ¤æ–­ swap çš„æƒ…å†µå—ï¼Ÿé»˜è®¤ pud huge page ä¸æ”¯æŒ swapï¼Ÿ</li><li>å¦‚æœ pmd é¡µè¡¨ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºã€‚</li><li>å¦‚æœ pmd é¡µè¡¨é¡¹ç©ºçš„ï¼Œåˆ™å°è¯•é€æ˜å¤§é¡µã€‚æˆåŠŸåˆ™è¿”å›ã€‚</li><li>å¦‚æœ pmd é¡µè¡¨é¡¹ä¸æ˜¯ç©ºçš„ï¼Œ...</li><li>æœ€åï¼Œ<code>handle_pte_fault()</code><ol><li>pte é¡µè¡¨é¡¹ä¸å­˜åœ¨çš„æƒ…å†µ <ol><li>ç§æœ‰åŒ¿åæ˜ å°„çš„æƒ…å†µ</li><li>æ–‡ä»¶æˆ–å…±äº«åŒ¿åæ˜ å°„çš„æƒ…å†µ</li></ol></li><li>pte é¡µè¡¨é¡¹å­˜åœ¨ï¼Œä½†æ˜¯é¡µä¸åœ¨ç‰©ç†å†…å­˜ä¸­</li><li>pte é¡µè¡¨é¡¹å­˜åœ¨ï¼Œé¡µä¹Ÿåœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œå¯èƒ½çš„åŸå› æœ‰ï¼š <ol><li>å…¶ä»– cpu åœ¨ä¿®æ”¹åŒä¸€ä¸ªé¡µè¡¨é¡¹</li><li>æ²¡å†™æƒé™ï¼Œè¿›è¡Œ CoWã€‚//XXX æ³¨æ„è¿™å’Œ <code>do_user_addr_fault()-&gt;bad_area_nosemaphore() å’Œ bad_area_access_error()</code> ä¸ä¸€æ ·ã€‚åè€…è¦ä¹ˆæ˜¯æ²¡æ‰¾åˆ° vmaï¼Œè¦ä¹ˆ vma-&gt;vm_flags é‡Œæ²¡ VM_WRITEï¼Œç”¨æˆ·æ€ç¨‹åºæ²¡æƒé™è®¿é—®ã€‚</li><li>æœ‰å†™æƒé™ï¼Œäº§ç”Ÿå¼‚å¸¸çš„åŸå› å¯èƒ½æ˜¯å› ä¸ºæ²¡å¯ç”¨ç¡¬ä»¶æ ‡è„ï¼Œéœ€è¦è½¯ä»¶æ¥ã€‚</li></ol></li></ol></li></ol><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handle_mm_fault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* hugetlb å¤§é¡µ */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unlikely</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">is_vm_hugetlb_page</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vma))) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hugetlb_fault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vma-&gt;vm_mm, vma, address, flags);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  else</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> __handle_mm_fault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vma, address, flags);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* æ™®é€šé¡µæˆ– thp */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pgd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pgd_offset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mm, address);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    p4d_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mm, pgd, address);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* pgd æ˜¯ NULL æ—¶æ‰ä¼š alloc */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vmf.pud </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pud_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mm, p4d, address);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* å°è¯• thp */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    create_huge_pud</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vmf);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vmf.pmd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pmd_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mm, vmf.pud, address);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* å°è¯• thp */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    create_huge_pmd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vmf);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    handle_pte_fault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vmf);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unlikely</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pmd_none</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vmf-&gt;pmd))) vmf-&gt;pte </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      else</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        /* è¿™é‡Œä¼šè®© vmf-&gt;ptl æŒ‡å‘é¡µè¡¨é” */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vmf-&gt;pte </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pte_offset_map_nolock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ptlp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pte_lockptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mm, pmdvalp);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unlikely</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vmf-&gt;pte)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vmf-&gt;orig_pte </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ptep_get_lockless</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf-&gt;pte);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      /* pte é¡µè¡¨é¡¹ä¸å­˜åœ¨ */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vmf-&gt;pte) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">do_pte_missing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        /* å¦‚æœæ˜¯ç§æœ‰åŒ¿åæ˜ å°„ï¼Œåˆ™å¤„ç†åŒ¿åé¡µçš„ç¼ºé¡µå¼‚å¸¸ */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vma_is_anonymous</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf-&gt;vma))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> do_anonymous_page</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        /* å¦‚æœæ˜¯æ–‡ä»¶æ˜ å°„ï¼Œæˆ–è€…å…±äº«åŒ¿åæ˜ å°„ï¼Œåˆ™å¤„ç†æ–‡ä»¶çš„ç¼ºé¡µå¼‚å¸¸ */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        else</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> do_fault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vma-&gt;vm_ops-&gt;fault)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf-&gt;flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FAULT_FLAG_WRITE))</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            do_read_fault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vma-&gt;vm_flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> VM_SHARED))</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            do_cow_fault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          else</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            do_shared_fault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      /* é¡µè¡¨é¡¹å­˜åœ¨ï¼Œä½†æ˜¯é¡µä¸åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œè¯´æ˜é¡µè¢«æ¢å‡ºåˆ° swap äº† */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pte_present</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf-&gt;orig_pte)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> do_swap_page</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      /* TODO å’Œ CONFIG_NUMA_BALANCING æœ‰å…³ */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pte_protnone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf-&gt;orig_pte) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vma_is_accessible</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf-&gt;vma))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> do_numa_page</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      /* å¦‚æœä»¥ä¸Šçš„éƒ½ä¸æ˜¯ï¼Œé‚£ä¹ˆï¼Œé¡µè¡¨é¡¹å­˜åœ¨ï¼Œé¡µä¹Ÿåœ¨ç‰©ç†å†…å­˜ä¸­ */</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      /* è·å–é¡µè¡¨é” */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      spin_lock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf-&gt;ptl);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      /* é‡æ–°è¯»å–é¡µè¡¨é¡¹çš„å€¼ï¼Œå¦‚æœä¸è·å–é”å‰çš„å€¼ä¸åŒï¼Œè¯´æ˜å…¶ä»– cpu å¯èƒ½æ­£åœ¨ä¿®æ”¹åŒä¸€ä¸ªé¡µè¡¨é¡¹ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         é‚£ä¹ˆå½“å‰å¤„ç†å™¨åªéœ€è¦ç­‰ç€ä½¿ç”¨å…¶ä»–å¤„ç†å™¨è®¾ç½®çš„é¡µè¡¨é¡¹ï¼Œè¿™é‡Œæ²¡å¿…è¦ç»§ç»­å¤„ç†äº† */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unlikely</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pte_same</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ptep_get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf-&gt;pte), entry)))</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        update_mmu_tlb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf-&gt;vma, vmf-&gt;address, vmf-&gt;pte);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> unlock;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      /* å¦‚æœæ˜¯ç”±å†™æ“ä½œé€ æˆçš„ï¼Œæˆ–è€…æ˜¯å¦å¤–ä¸€ç§æƒ…å†µé€ æˆçš„</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         TODO å¦å¤–ä¸€ç§æƒ…å†µæ˜¯åœ¨ __get_user_pages-&gt;faultin_page é‡Œè®¾ç½®äº† FAULT_FLAG_UNSHARE */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (vmf-&gt;flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (FAULT_FLAG_WRITE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">FAULT_FLAG_UNSHARE))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        /* å¦‚æœæ²¡æœ‰å†™æƒé™ï¼Œåˆ™è¿›è¡Œ CoW */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pte_write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> do_wp_page</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        /* å¯¹äº ARM æ¶æ„ï¼Œå¦‚æœæœªå¯ç”¨ç¡¬ä»¶ç®¡ç† dirty stateï¼Œé‚£ä¹ˆ writable-clean çš„æè¿°ç¬¦ä¼šé€ æˆ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           Permission faultï¼Œç”± Linux ç®¡ç† dirty state */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">likely</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf-&gt;flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FAULT_FLAG_WRITE)) entry </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pte_mkdirty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      /* ç½®ä¸Š Access flag */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      entry </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pte_mkyoung</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      /* å¦‚æœ pte å’Œä¹‹å‰çš„ç›¸æ¯”æœ‰å˜åŒ–ï¼Œåˆ™æ›´æ–°é¡µè¡¨é‡Œçš„é¡µè¡¨é¡¹ï¼Œå¹¶è¿›è¡Œ TLB invalid */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ptep_set_access_flags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf-&gt;vma, vmf-&gt;address, vmf-&gt;pte, entry, vmf-&gt;flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FAULT_FLAG_WRITE))</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        update_mmu_cache_range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf, vmf-&gt;vma, vmf-&gt;address, vmf-&gt;pte, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><p>pgd p4d pud pmd pte page å¯¹åº”çš„ <code>struct page</code> çš„å†…å®¹å…¶å®æ˜¯ 64byte çš„ <code>struct ptdesc</code>ã€‚ å¦‚æœå¯ç”¨äº† <code>CONFIG_SPLIT_PTE_PTLOCKS</code>ï¼Œé‚£ä¹ˆ <code>pte_lockptr()</code> è¿”å›çš„å°±æ˜¯ç»†ç²’åº¦çš„ ptdesc é‡Œçš„ ptlï¼Œå¦åˆ™å°±æ˜¯ç²—ç²’åº¦çš„ mm_struct é‡Œçš„ page_table_lockã€‚</p><p>å…³äº <code>hugetlb_fault()</code>ï¼Œè¯¦è§ <a href="./hugetlb">hugetlb</a>ã€‚ å…³äºä¸ºä»€ä¹ˆå…±äº«åŒ¿åæ˜ å°„ä¸ºä»€ä¹ˆ <code>vma_is_anonymous()</code> æ˜¯ falseï¼Œä¸ºä»€ä¹ˆå’Œæ–‡ä»¶æ˜ å°„ä¸€æ ·ç”¨ <code>do_fault()</code> å¤„ç†ï¼Œè§ <a href="./mmap">mmap</a>ã€‚</p><p>å…³äº ARM æ¶æ„çš„ dirty state ç®¡ç†ï¼Œè¯¦è§ <a href="./../arch/arm/virtual_memory">The AArch64 Virtual Memory System Architecture</a>ã€‚</p><ul class="contains-task-list"><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> æ¶‰åŠåˆ°ä¸€äº› thp ç›¸å…³çš„ï¼Œæš‚ä¸è®¨è®º <ul class="contains-task-list"><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> Support for transparent PUD pages for DAX files <a href="https://lwn.net/Articles/674185/" target="_blank" rel="noreferrer">https://lwn.net/Articles/674185/</a></li></ul></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <code>FAULT_FLAG_UNSHARE</code> æ˜¯å•¥ä½œç”¨ï¼Ÿ <a href="https://lore.kernel.org/all/20220428083441.37290-16-david@redhat.com/" target="_blank" rel="noreferrer">[PATCH v4 15/17] mm: support GUP-triggered unsharing of anonymous pages - David Hildenbrand</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> devmap æ˜¯ä»€ä¹ˆï¼Ÿ</li></ul><h3 id="do-anonymous-page-ç§æœ‰-åŒ¿åé¡µçš„ç¼ºé¡µå¼‚å¸¸" tabindex="-1">do_anonymous_page (ç§æœ‰)åŒ¿åé¡µçš„ç¼ºé¡µå¼‚å¸¸ <a class="header-anchor" href="#do-anonymous-page-ç§æœ‰-åŒ¿åé¡µçš„ç¼ºé¡µå¼‚å¸¸" aria-label="Permalink to â€œdo_anonymous_page (ç§æœ‰)åŒ¿åé¡µçš„ç¼ºé¡µå¼‚å¸¸â€">â€‹</a></h3><p><code>vma_is_anonymous()</code> å‡½æ•°è®¤ä¸º <code>vma-&gt;vm_ops</code> ä¸º NULL çš„æ˜¯åŒ¿åé¡µã€‚</p><p>å…±äº«åŒ¿åæ˜ å°„çš„é¡µé¢ï¼Œå…¶ vm_ops ä¸æ˜¯ NULLï¼Œæ˜¯ <code>shmem_anon_vm_ops</code>ï¼Œå› æ­¤ä¸è¢«è§†ä½œåŒ¿åé¡µï¼Œè€Œæ˜¯æ–‡ä»¶é¡µã€‚è¯¦è§ <a href="./mmap">mmap</a> TODO ä¸ºå•¥è¿™ä¹ˆè®¾è®¡ï¼Ÿæˆ‘çš„ç†è§£ï¼šlinux æŠŠè¿™ä¸€å—å…±äº«çš„èµ„æºæŠ½è±¡ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Ÿå¤šä¸ªè¿›ç¨‹å…±äº«è¿™ä¸ªå†…å­˜ï¼Œå°±ç›¸å½“äºæ˜¯å…±äº«è¿™ä¸ªæ–‡ä»¶ï¼Ÿ</p><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">do_anonymous_page</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* å¦‚æœæ˜¯ vm_ops ä¸º NULL çš„å…±äº«æ˜ å°„ï¼Œè¯´æ˜æœ‰é—®é¢˜ */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (vma-&gt;vm_flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> VM_SHARED) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> VM_FAULT_SIGBUS;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* å¦‚æœ pte é¡µè¡¨ä¸å­˜åœ¨ï¼Œåˆ™åˆ†é…ï¼Œå¹¶åˆå§‹åŒ– ptdesc */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  pte_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vma-&gt;vm_mm, vmf-&gt;pmd);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* å¦‚æœä¸æ˜¯å†™æ“ä½œå¯¼è‡´çš„ faultï¼Œåˆ™ä½¿ç”¨ zero page */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf-&gt;flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FAULT_FLAG_WRITE))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* æ˜ å°„åˆ°ä¸“ç”¨çš„é›¶é¡µï¼Œå¹¶ç½®ä¸Šè½¯ä»¶å®šä¹‰çš„ PTE_SPECIAL flag */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    entry </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pte_mkspecial</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pfn_pte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">my_zero_pfn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf-&gt;address)));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* æ‰¾åˆ° pte é¡µè¡¨é¡¹ï¼Œå¹¶ä¸Šé” */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vmf-&gt;pte </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pte_offset_map_lock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* ___pte_offset_map è¿”å› NULLï¼Œè¯´æ˜è·å– pte å¤±è´¥ï¼Œæ¯”å¦‚å› ä¸ºæ˜¯å¤§é¡µæˆ– devmapï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       ä¼š gotounlock è¿”å› 0ï¼Œè¿™æ˜¯å› ä¸ºæœ‰å¯èƒ½åŒæ—¶å¦ä¸€ä¸ªçº¿ç¨‹å‘ç”Ÿäº† huge pmd fault å¹¶å¤„ç†äº†ï¼Ÿ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       XXX ä¼šæœ‰è¿™ç§æƒ…å†µå—ï¼Ÿçœ‹çœ‹ git history */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vmf-&gt;pte) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> unlock;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* åœ¨æˆ‘ä»¬è·å–é”å‰ï¼Œæœ‰å¯èƒ½å¦ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨å¤„ç†ç›¸åŒ page çš„å¼‚å¸¸ */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vmf_pte_changed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf)) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update_mmu_tlb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> unlock;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* å»æ›´æ–°é¡µè¡¨ */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> setpte;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* TODO åŒ¿åé¡µçš„åå‘æ˜ å°„ */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  vmf_anon_prepare</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* åˆ†é…æˆ‘ä»¬è‡ªå·±çš„ç§æœ‰é¡µï¼Œä¼šä¼˜å…ˆä» highmem åˆ†é…ï¼Œå¹¶åˆå§‹åŒ–ä¸º 0ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     TODO è¿™é‡Œå¯èƒ½å› ä¸º thp ä¸€ä¸‹å­åˆ†é…å¤šä¸ªé¡µé¢ï¼Ÿ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     https://lore.kernel.org/all/20231207161211.2374093-1-ryan.roberts@arm.com/ */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  alloc_anon_folio</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* TODO æ¶‰åŠä¸€å † thp ç›¸å…³çš„ */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    folio_prealloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(, need_zero</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* ç»™ struct page çš„ -&gt;flags ç½®ä¸Š PG_uptodateï¼Œè¡¨ç¤ºç‰©ç†é¡µåŒ…å«æœ‰æ•ˆçš„æ•°æ® */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  __folio_mark_uptodate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(folio);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* ç”Ÿæˆé¡µè¡¨é¡¹ */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  entry </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mk_pte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">folio-&gt;page, vma-&gt;vm_page_prot);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* é™¤äº†ä¸æ”¯æŒç¡¬ä»¶è®¾ç½® Access bit çš„ MIPS æ¶æ„ä»¥å¤–ï¼Œå…¶ä»–æ¶æ„çš„è¿™ä¸ªå•¥ä¹Ÿæ²¡åšã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     è¯¦è§ https://lore.kernel.org/all/1590546320-21814-4-git-send-email-maobibo@loongson.cn/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     XXX æœ‰äº› arm cpu ä¹Ÿä¸æ”¯æŒç¡¬ä»¶è®¾ç½® Access bit å§ï¼Œè¿™é‡Œæ˜¯ä¸æ˜¯ pte_mkyoung æ›´å¥½äº›ï¼Œå¯ä»¥çœå»ä¸€æ¬¡ page fault ? */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  entry </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pte_sw_mkyoung</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* å¯¹äºæŸäº›ä¸æ”¯æŒç¡¬ä»¶è®¾ç½® dirty bit çš„ ARM æœºå™¨ï¼Œè¿™é‡Œ pte_mkdirty æ ‡è®°è„é¡µï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     ä½¿å¾— entry ä¸º Writable-dirtyï¼Œè¿™æ ·ä¸‹æ¬¡ write æ—¶å°±ä¸ä¼š Permission fault */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (vma-&gt;vm_flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> VM_WRITE)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    entry </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pte_mkwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pte_mkdirty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry), vma);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* æ‰¾åˆ° pte é¡µè¡¨é¡¹ï¼Œå¹¶ä¸Šé” */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  vmf-&gt;pte </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pte_offset_map_lock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vmf-&gt;pte) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> release;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* å»ºç«‹èµ·åŒ¿åé¡µçš„åå‘æ˜ å°„ */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  folio_add_new_anon_rmap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(folio, vma, addr, RMAP_EXCLUSIVE);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* æ”¾åˆ° LRU é“¾è¡¨ä¸­ */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  folio_add_lru_vma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(folio, vma);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">setpte:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* è®¾ç½®é¡µè¡¨é¡¹ */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  set_ptes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vma-&gt;vm_mm, addr, vmf-&gt;pte, entry, nr_pages);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* æ›´æ–° TLB */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  update_mmu_cache_range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vmf, vma, addr, vmf-&gt;pte, nr_pages);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><ul class="contains-task-list"><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> userfaultfd ç›¸å…³çš„éƒ¨åˆ†</li></ul><h3 id="do-fault-æ–‡ä»¶é¡µçš„ç¼ºé¡µå¼‚å¸¸" tabindex="-1">do_fault æ–‡ä»¶é¡µçš„ç¼ºé¡µå¼‚å¸¸ <a class="header-anchor" href="#do-fault-æ–‡ä»¶é¡µçš„ç¼ºé¡µå¼‚å¸¸" aria-label="Permalink to â€œdo_fault æ–‡ä»¶é¡µçš„ç¼ºé¡µå¼‚å¸¸â€">â€‹</a></h3><p>å“ªäº›æƒ…å†µä¼šè§¦å‘æ–‡ä»¶é¡µçš„ç¼ºé¡µå¼‚å¸¸å‘¢ï¼Ÿ</p><ol><li>å¯åŠ¨ç”¨æˆ·æ€ç¨‹åºçš„æ—¶å€™ï¼Œä»£ç æ®µå’Œæ•°æ®æ®µåˆ›å»ºç§æœ‰çš„æ–‡ä»¶æ˜ å°„ï¼Œæ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™è§¦å‘æ–‡ä»¶é¡µçš„ç¼ºé¡µå¼‚å¸¸ã€‚</li><li>è¿›ç¨‹ä½¿ç”¨ mmap åˆ›å»ºæ–‡ä»¶æ˜ å°„ï¼ŒæŠŠæ–‡ä»¶çš„ä¸€ä¸ªåŒºé—´æ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™è§¦å‘æ–‡ä»¶é¡µçš„ç¼ºé¡µå¼‚å¸¸ã€‚</li><li>è¿›ç¨‹ <code>mmap(,,MAP_SHARED|MAP_ANONYMOUS)</code> åˆ›å»ºå…±äº«åŒ¿åæ˜ å°„ï¼Œç¬¬ä¸€æ¬¡è®¿é—®æ—¶è§¦å‘ç¼ºé¡µå¼‚å¸¸</li></ol><p>å‡½æ•° <code>do_fault()</code> å¤„ç†æ–‡ä»¶é¡µå’Œå…±äº«åŒ¿åé¡µçš„ç¼ºé¡µå¼‚å¸¸</p><p>ç›¸å…³å†…å®¹ï¼š<a href="./../storage/pagecache">pagecache</a></p><h4 id="do-read-fault-å¤„ç†è¯»æ–‡ä»¶é¡µé”™è¯¯" tabindex="-1">do_read_fault å¤„ç†è¯»æ–‡ä»¶é¡µé”™è¯¯ <a class="header-anchor" href="#do-read-fault-å¤„ç†è¯»æ–‡ä»¶é¡µé”™è¯¯" aria-label="Permalink to â€œdo_read_fault å¤„ç†è¯»æ–‡ä»¶é¡µé”™è¯¯â€">â€‹</a></h4><p>æ–‡ä»¶é¡µå†…å®¹ä¸åœ¨ page cache é‡Œï¼Œ</p><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="do-cow-fault-å¤„ç†å†™ç§æœ‰æ–‡ä»¶é¡µé”™è¯¯" tabindex="-1">do_cow_fault å¤„ç†å†™ç§æœ‰æ–‡ä»¶é¡µé”™è¯¯ <a class="header-anchor" href="#do-cow-fault-å¤„ç†å†™ç§æœ‰æ–‡ä»¶é¡µé”™è¯¯" aria-label="Permalink to â€œdo_cow_fault å¤„ç†å†™ç§æœ‰æ–‡ä»¶é¡µé”™è¯¯â€">â€‹</a></h4><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="do-shared-fault-å¤„ç†å†™å…±äº«æ–‡ä»¶-åŒ¿åé¡µé”™è¯¯" tabindex="-1">do_shared_fault å¤„ç†å†™å…±äº«æ–‡ä»¶/åŒ¿åé¡µé”™è¯¯ <a class="header-anchor" href="#do-shared-fault-å¤„ç†å†™å…±äº«æ–‡ä»¶-åŒ¿åé¡µé”™è¯¯" aria-label="Permalink to â€œdo_shared_fault å¤„ç†å†™å…±äº«æ–‡ä»¶/åŒ¿åé¡µé”™è¯¯â€">â€‹</a></h4><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="do-swap-page-é¡µé¢æ¢å…¥" tabindex="-1">do_swap_page é¡µé¢æ¢å…¥ <a class="header-anchor" href="#do-swap-page-é¡µé¢æ¢å…¥" aria-label="Permalink to â€œdo_swap_page é¡µé¢æ¢å…¥â€">â€‹</a></h3><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="do-wp-page-å¤„ç†å†™æ—¶å¤åˆ¶" tabindex="-1">do_wp_page å¤„ç†å†™æ—¶å¤åˆ¶ <a class="header-anchor" href="#do-wp-page-å¤„ç†å†™æ—¶å¤åˆ¶" aria-label="Permalink to â€œdo_wp_page å¤„ç†å†™æ—¶å¤åˆ¶â€">â€‹</a></h3><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="å†…æ ¸æ¨¡å¼é¡µé”™è¯¯å¼‚å¸¸" tabindex="-1">å†…æ ¸æ¨¡å¼é¡µé”™è¯¯å¼‚å¸¸ <a class="header-anchor" href="#å†…æ ¸æ¨¡å¼é¡µé”™è¯¯å¼‚å¸¸" aria-label="Permalink to â€œå†…æ ¸æ¨¡å¼é¡µé”™è¯¯å¼‚å¸¸â€">â€‹</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@[</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    bpf_prog_6deef7357e7b4530_sd_fw_ingress+12846</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    bpf_prog_6deef7357e7b4530_sd_fw_ingress+12846</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    bpf_trampoline_6442466157+67</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    __do_fault+5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    do_fault+279</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    __handle_mm_fault+1986</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    handle_mm_fault+226</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    do_user_addr_fault+349</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    exc_page_fault+129</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    asm_exc_page_fault+38</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    _copy_to_iter+199</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    copy_page_to_iter+140</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    filemap_read+478</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    vfs_read+665</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    __x64_sys_pread64+152</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    do_syscall_64+130</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    entry_SYSCALL_64_after_hwframe+118</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]: 1065</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@[</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    bpf_prog_6deef7357e7b4530_sd_fw_ingress+12846</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    bpf_prog_6deef7357e7b4530_sd_fw_ingress+12846</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    bpf_trampoline_6442466157+67</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    __do_fault+5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    do_fault+279</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    __handle_mm_fault+1986</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    handle_mm_fault+226</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    do_user_addr_fault+349</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    exc_page_fault+129</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    asm_exc_page_fault+38</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    _copy_to_iter+199</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    copy_page_to_iter+140</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    shmem_file_read_iter+264</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    vfs_read+665</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    __x64_sys_pread64+152</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    do_syscall_64+130</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    entry_SYSCALL_64_after_hwframe+118</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]: 1362</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@[</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    bpf_prog_6deef7357e7b4530_sd_fw_ingress+12846</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    bpf_prog_6deef7357e7b4530_sd_fw_ingress+12846</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    bpf_trampoline_6442466157+67</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    __do_fault+5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    do_fault+279</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    __handle_mm_fault+1986</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    handle_mm_fault+226</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    do_user_addr_fault+535</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    exc_page_fault+129</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    asm_exc_page_fault+38</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]: 18173</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p><a href="https://www.lxlinux.net/8943.html" target="_blank" rel="noreferrer">è¯¦è§£ Linux å†…æ ¸ä¹‹è„é¡µè·Ÿè¸ª-è‰¯è®¸ Linux æ•™ç¨‹ç½‘</a><a href="https://www.cnblogs.com/sky-heaven/p/16621085.html" target="_blank" rel="noreferrer">linux é‚£äº›äº‹ä¹‹ zero pageã€è½¬ã€‘ - Sky&amp;Zhang - åšå®¢å›­</a><a href="https://tinylab.org/riscv-page-fault-part2/" target="_blank" rel="noreferrer">RISC-V ç¼ºé¡µå¼‚å¸¸å¤„ç†ç¨‹åºåˆ†æï¼ˆ2ï¼‰ï¼šhandle_pte_fault() å’Œ do_anonymous_page() - æ³°æ™“ç§‘æŠ€</a><a href="https://blog.csdn.net/zf1575192187/article/details/105207086" target="_blank" rel="noreferrer">ARM Linux å¦‚ä½•æ¨¡æ‹Ÿ X86 PTE ä¸­çš„ Present Young å’Œ Dirty æ ‡å¿—ä½_arm æ€ä¹ˆæ¨¡æ‹Ÿ dirty-CSDN åšå®¢</a></p></div></div></main><footer class="VPDocFooter" data-v-d668f7cc data-v-1bcd8184><!--[--><!--]--><div class="edit-info" data-v-1bcd8184><div class="edit-link" data-v-1bcd8184><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/hyuuko1/blog/edit/main/mm/pagefault.md" target="_blank" rel="noreferrer" data-v-1bcd8184><!--[--><span class="vpi-square-pen edit-link-icon" data-v-1bcd8184></span> Edit this page<!--]--></a></div><div class="last-updated" data-v-1bcd8184><p class="VPLastUpdated" data-v-1bcd8184 data-v-73dafb42>æœ€åæ›´æ–°äº: <time datetime="2025-11-23T15:44:07.000Z" data-v-73dafb42></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link prev" href="/blog/mm/kmap" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>ä¸Šä¸€é¡µ</span><span class="title" data-v-1bcd8184>kmap</span><!--]--></a></div><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link next" href="/blog/mm/page_table" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>ä¸‹ä¸€é¡µ</span><span class="title" data-v-1bcd8184>ğŸš§ page table</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-304c8b69 data-v-5b9946f5><div class="container" data-v-5b9946f5><p class="message" data-v-5b9946f5>Licensed under MIT</p><p class="copyright" data-v-5b9946f5>Copyright Â© 2024-2025 HYUUKO</p></div></footer><!--[--><!--]--></div></div>
    
    
  </body>
</html>