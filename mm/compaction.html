<!DOCTYPE html>
<html lang="zh-Hans" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å†…å­˜è§„æ•´ | Blog</title>
    <meta name="description" content="Linux kernel å†…æ ¸ä»£ç åˆ†æï¼ŒåŸç†è¯¦è§£">
    <meta name="generator" content="VitePress v2.0.0-alpha.13">
    <link rel="preload stylesheet" href="/blog/assets/style.Cg8D8EfQ.css" as="style">
    <link rel="preload stylesheet" href="/blog/vp-icons.css" as="style">
    <script type="module" src="/blog/assets/chunks/metadata.e2231c71.js"></script>
    <script type="module" src="/blog/assets/app.DgFSTuZM.js"></script>
    <link rel="preload" href="/blog/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/blog/assets/chunks/theme.3WDp7bvS.js">
    <link rel="modulepreload" href="/blog/assets/chunks/framework.CdzZEkix.js">
    <link rel="modulepreload" href="/blog/assets/mm_compaction.md.DvmlPQlG.lean.js">
    <link rel="icon" type="image/svg+xml" href="/blog/linux.svg">
    <link rel="icon" type="image/png" href="/blog/linux-32x32.png">
    <meta name="theme-color" content="#5f67ee">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:title" content="å†…å­˜è§„æ•´ | Blog">
    <meta property="og:site_name" content="Linux kernel å†…æ ¸ä»£ç åˆ†æï¼ŒåŸç†è¯¦è§£">
    <meta property="og:url" content="https://hyuuko.vercel.app">
    <meta name="google-site-verification" content="OMML6xlbLb2Asitovo85pbOZGTvYoWaYWYW3ps7083s">
    <meta name="msvalidate.01" content="E3B108A75866D6C18B16BE35E14DE820">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-304c8b69><!--[--><!--]--><!--[--><span tabindex="-1" data-v-10d4d845></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-10d4d845>Skip to content</a><!--]--><!----><header class="VPNav" data-v-304c8b69 data-v-d5bf7c8e><div class="VPNavBar" data-v-d5bf7c8e data-v-8eab0e6d><div class="wrapper" data-v-8eab0e6d><div class="container" data-v-8eab0e6d><div class="title" data-v-8eab0e6d><div class="VPNavBarTitle has-sidebar" data-v-8eab0e6d data-v-d4488dd0><a class="title" href="/blog/" data-v-d4488dd0><!--[--><!--]--><!--[--><img class="VPImage logo" src="/blog/linux.svg" width="20" height="20" alt data-v-ab19afbb><!--]--><span data-v-d4488dd0>Blog</span><!--[--><!--]--></a></div></div><div class="content" data-v-8eab0e6d><div class="content-body" data-v-8eab0e6d><!--[--><!--]--><div class="VPNavBarSearch search" data-v-8eab0e6d><!--[--><!----><div id="local-search"><button type="button" aria-label="æœç´¢æ–‡æ¡£" aria-keyshortcuts="/ control+k meta+k" class="DocSearch DocSearch-Button"><span class="DocSearch-Button-Container"><span class="vpi-search DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">æœç´¢æ–‡æ¡£</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key"></kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-8eab0e6d data-v-020be4db><span id="main-nav-aria-label" class="visually-hidden" data-v-020be4db> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/blog/mm/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>å†…å­˜ç®¡ç†</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/net/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>ç½‘ç»œ</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/storage/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>å­˜å‚¨</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/process/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>è¿›ç¨‹</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/sched/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>è°ƒåº¦</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/irq/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>ä¸­æ–­</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/arch/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>ä½“ç³»ç»“æ„</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/debug/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>è°ƒè¯•</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/virtualization/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>è™šæ‹ŸåŒ–</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-020be4db data-v-d8fae6e2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-d8fae6e2><span class="text" data-v-d8fae6e2><!----><span data-v-d8fae6e2>æ‚é¡¹</span><span class="vpi-chevron-down text-icon" data-v-d8fae6e2></span></span></button><div class="menu" data-v-d8fae6e2><div class="VPMenu" data-v-d8fae6e2 data-v-fcd1d7a8><div class="items" data-v-fcd1d7a8><!--[--><!--[--><div class="VPMenuLink" data-v-fcd1d7a8 data-v-acfa8338><a class="VPLink link" href="/blog/other/index" data-v-acfa8338><!--[--><span data-v-acfa8338>å…¶ä»–</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fcd1d7a8 data-v-acfa8338><a class="VPLink link" href="/blog/init/index" data-v-acfa8338><!--[--><span data-v-acfa8338>åˆå§‹åŒ–</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fcd1d7a8 data-v-acfa8338><a class="VPLink link" href="/blog/pm/index" data-v-acfa8338><!--[--><span data-v-acfa8338>ç”µæºç®¡ç†</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-8eab0e6d data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-8eab0e6d data-v-ef6192dc data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/hyuuko1/blog" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-8eab0e6d data-v-600b50c9 data-v-d8fae6e2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-d8fae6e2><span class="vpi-more-horizontal icon" data-v-d8fae6e2></span></button><div class="menu" data-v-d8fae6e2><div class="VPMenu" data-v-d8fae6e2 data-v-fcd1d7a8><!----><!--[--><!--[--><!----><div class="group" data-v-600b50c9><div class="item appearance" data-v-600b50c9><p class="label" data-v-600b50c9>ä¸»é¢˜</p><div class="appearance-action" data-v-600b50c9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-600b50c9 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-600b50c9><div class="item social-links" data-v-600b50c9><div class="VPSocialLinks social-links-list" data-v-600b50c9 data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/hyuuko1/blog" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-8eab0e6d data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-8eab0e6d><div class="divider-line" data-v-8eab0e6d></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-304c8b69 data-v-5ae341c6><div class="container" data-v-5ae341c6><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-5ae341c6><span class="vpi-align-left menu-icon" data-v-5ae341c6></span><span class="menu-text" data-v-5ae341c6>èœå•</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-5ae341c6 data-v-e28a51a6><button data-v-e28a51a6>å›åˆ°é¡¶éƒ¨</button><!----></div></div></div><aside class="VPSidebar" data-v-304c8b69 data-v-46b39de1><div class="curtain" data-v-46b39de1></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-46b39de1><span class="visually-hidden" id="sidebar-aria-label" data-v-46b39de1> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å‰è¨€</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/update" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>æ›´æ–°è®¡åˆ’</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/gorman_book" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ UTLVMM (Linux 2.6)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>æè¿°ç‰©ç†å†…å­˜</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/layout" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>å†…å­˜å¸ƒå±€</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/e820" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>e820</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/node" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>node</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/zone" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>zone</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/folio" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>struct page/folio è¯¦è§£</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/vmemmap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>pfn_to_page() çš„åŸç†ï¼šmem_section ä¸ vmemmap</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>è™šæ‹Ÿå†…å­˜æ˜ å°„</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/rmap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>rmap åå‘æ˜ å°„</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/vma" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>vma</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/mmap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>mmap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/vmap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>vmap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/kmap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>kmap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/pagefault" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>page fault</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/page_table" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ page table</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/ioremap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ ioremap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/fixmap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ fixmap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/highmem" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ highmem é«˜ç«¯å†…å­˜</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/cow" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ CoW (Copy on Write)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/uffd" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ UFFD (userfaultfd)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/shmem" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ share memory</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/tlb" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ tlb</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/dma_buf" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ dma-buf</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å†…å­˜åˆ†é…</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/buddy" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Buddy System: é¡µé¢åˆ†é…å™¨</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/vmalloc" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>vmalloc: ä¸è¿ç»­ç‰©ç†å†…å­˜åˆ†é…</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/percpu" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>per-cpu é™æ€å’ŒåŠ¨æ€åˆ†é…</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/oom" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>OOM (Out Of Memory)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/slub" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>SLUB å†…å­˜åˆ†é…å™¨</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/cma" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>CMA è¿ç»­å†…å­˜åˆ†é…å™¨</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/memblock" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ æ—©æœŸå†…å­˜åˆ†é…å™¨ memblock</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/gfp" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>GFP (Get Free Page)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å¤§é¡µ</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/hugetlb" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>HugeTLB æ ‡å‡†å¤§é¡µ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/thp" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>THP (Transparent Huge Page) é€æ˜å¤§é¡µ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/mthp" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>mTHP (Multi-size Transparent Huge Page)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å†…å­˜å›æ”¶</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/reclaim/reclaim" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>å†…å­˜å›æ”¶(åºŸå¼ƒ)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/reclaim/basic" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>å†…å­˜å›æ”¶åŸºç¡€</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/reclaim/lru" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>LRU</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/reclaim/mglru" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>MGLRU</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/reclaim/workingset" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>workingset</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/reclaim/swap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>swap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/mlock" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>mlock</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible has-active" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å†…å­˜åç¢ç‰‡</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/anti-fragmentation" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ å†…å­˜åç¢ç‰‡</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/compaction" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ å†…å­˜è§„æ•´</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/page_migration" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>é¡µé¢è¿ç§»</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å…¶ä»–</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/gup" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>GUP (Get User Page)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/pageflags" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>pageflags</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/madvise" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ madvise</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/ksm" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ KSM (Kernel Samepage Merging)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/hotplug" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ hotplug</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/virtio_mem" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ virtio mem</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/virtio_pmem" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ virtio pmem</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/virtio_balloon" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ virtio balloon</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Non-Uniform Memory Access architecture</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/mempolicy" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ Memory Policy å†…å­˜ç­–ç•¥</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å†…å­˜ç®¡ç†ä¸æ–‡ä»¶ç³»ç»Ÿ</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/storage/readahead" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ readahead é¢„è¯»</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/storage/pagecache" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ page cache</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/storage/page_writeback" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ page writeback</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/storage/tmpfs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ tmpfs</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/storage/ramfs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ ramfs</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-304c8b69 data-v-2652e39a><div class="VPDoc has-sidebar has-aside" data-v-2652e39a data-v-d668f7cc><!--[--><!--]--><div class="container" data-v-d668f7cc><div class="aside" data-v-d668f7cc><div class="aside-curtain" data-v-d668f7cc></div><div class="aside-container" data-v-d668f7cc><div class="aside-content" data-v-d668f7cc><div class="VPDocAside" data-v-d668f7cc data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-c8b19031><div class="content" data-v-c8b19031><div class="outline-marker" data-v-c8b19031></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-c8b19031>ç›®å½•</div><ul class="VPDocOutlineItem root" data-v-c8b19031 data-v-63c57e50><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d668f7cc><div class="content-container" data-v-d668f7cc><!--[--><!--]--><main class="main" data-v-d668f7cc><div style="position:relative;" class="vp-doc _blog_mm_compaction external-link-icon-enabled" data-v-d668f7cc><div><h1 id="å†…å­˜è§„æ•´" tabindex="-1">å†…å­˜è§„æ•´ <a class="header-anchor" href="#å†…å­˜è§„æ•´" aria-label="Permalink to â€œå†…å­˜è§„æ•´â€">â€‹</a></h1><ul><li><a href="https://www.cnblogs.com/tolimit/p/5286663.html" target="_blank" rel="noreferrer">linux å†…å­˜æºç åˆ†æ - å†…å­˜ç¢ç‰‡æ•´ç†(å®ç°æµç¨‹) - tolimit - åšå®¢å›­</a></li><li><a href="https://www.cnblogs.com/tolimit/p/5432674.html" target="_blank" rel="noreferrer">linux å†…å­˜æºç åˆ†æ - å†…å­˜ç¢ç‰‡æ•´ç†(åŒæ­¥å…³ç³») - tolimit - åšå®¢å›­</a></li><li><a href="https://blog.csdn.net/feelabclihu/article/details/134343592" target="_blank" rel="noreferrer">è¶…è¯¦ç»†ï¼Linux å†…æ ¸å†…å­˜è§„æ•´è¯¦è§£</a> /proc/vmstat</li><li><a href="https://blog.csdn.net/u010923083/article/details/116137687" target="_blank" rel="noreferrer">[å†…æ ¸å†…å­˜] [arm64] å†…å­˜è§„æ•´ 1---memory-compaction è¯¦è§£</a></li><li><a href="https://blog.csdn.net/u010923083/article/details/116138670" target="_blank" rel="noreferrer">[å†…æ ¸å†…å­˜] [arm64] å†…å­˜è§„æ•´ 2---é¡µé—´å†…å®¹çš„è¿ç§»ï¼ˆ__unmap_and_move å‡½æ•°)</a></li><li><a href="https://www.cnblogs.com/LoyenWang/p/11746357.html" target="_blank" rel="noreferrer">ã€åŸåˆ›ã€‘ï¼ˆä¹ï¼‰Linux å†…å­˜ç®¡ç† - zoned page frame allocator - 4 - LoyenWang - åšå®¢å›­</a></li><li><a href="https://zhuanlan.zhihu.com/p/81983973" target="_blank" rel="noreferrer">Linux ä¸­çš„ Memory Compaction [ä¸€] - çŸ¥ä¹</a></li><li><a href="https://zhuanlan.zhihu.com/p/105745299" target="_blank" rel="noreferrer">Linux ä¸­çš„ Memory Compaction [äºŒ] - CMA - çŸ¥ä¹</a></li><li><a href="https://zhuanlan.zhihu.com/p/117239320" target="_blank" rel="noreferrer">Linux ä¸­çš„ Memory Compaction [ä¸‰] - THP - çŸ¥ä¹</a></li><li><a href="https://tinylab.org/lwn-717656/" target="_blank" rel="noreferrer">LWN 717656: ä¸»åŠ¨ï¼ˆproactiveï¼‰å†…å­˜è§„æ•´ï¼ˆcompactionï¼‰ - æ³°æ™“ç§‘æŠ€</a></li></ul><p>Memory Compaction å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ol><li>æ”¶é›† page block å†…çš„è¿ç§»é¡µå’Œç©ºé—²é¡µ</li><li>åŸºäº Page Migration æŠ€æœ¯å®Œæˆé¡µé¢è¿ç§»ï¼Œå½¢æˆä¸€å—è¿ç»­å†…å­˜ã€‚</li></ol><p>å› æ­¤å»ºè®®å…ˆçœ‹ <a href="./page_migration">page_migration</a></p><p>æˆªè‡³æœ¬æ–‡æ›´æ–°æ—¶ï¼Œlinux å†…æ ¸ç‰ˆæœ¬ä¸º 6.16</p><ul class="contains-task-list"><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> æ•´ç† .c æ–‡ä»¶ä¸­è¢«å¤–éƒ¨è°ƒç”¨çš„å‡½æ•°ï¼Œæ¢³ç†ä¸‹åŠŸèƒ½ç‚¹</li></ul><h2 id="patch-åˆ†æ" tabindex="-1">patch åˆ†æ <a class="header-anchor" href="#patch-åˆ†æ" aria-label="Permalink to â€œpatch åˆ†æâ€">â€‹</a></h2><ul><li><a href="https://lwn.net/Articles/368869/" target="_blank" rel="noreferrer">Memory compaction [LWN.net]</a><ul><li><a href="https://lore.kernel.org/all/1271797276-31358-1-git-send-email-mel@csn.ul.ie/" target="_blank" rel="noreferrer">[PATCH 0/14] Memory Compaction v8 - Mel Gorman</a></li></ul></li></ul><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f6c82728f4e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mm: migration: take a reference to the anon_vma before migrating</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	åŒ¿ååå‘æ˜ å°„å¢åŠ  migrate_refcountï¼Œ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f60c214fd3a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mm: migration: share the anon_vma ref counts between KSM </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> page migration</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">67</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">b9509b2c68</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mm: migration: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> to migrate unmapped anonymous pages</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fe2011ff51e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mm: migration: allow the migration of PageSwapCache pages</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e9e96b39f932 mm: allow CONFIG_MIGRATION to be set without CONFIG_NUMA </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">or</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> memory hot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">remove</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a8bef8ff6ea1 mm: migration: avoid race between </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">shift_arg_pages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rmap_walk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() during migration by </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> migrating temporary stacks</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">d7a5752c0c19 mm: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> unusable free space index via debugfs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">f1a5ab121057 mm: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fragmentation index via debugfs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">c175a0ce7584 mm: move definition </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LRU isolation modes to a header</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">748446</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bb6b5a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mm: compaction: memory compaction core</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">76</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ab0f530e4a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mm: compaction: add </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">proc trigger </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> memory compaction</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ed4a6d7f0676 mm: compaction: add </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sys trigger </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> per</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">node memory compaction</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">56</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">de7263fcf3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mm: compaction: direct compact when a high</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">order allocation fails</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">e</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7719058079</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mm: compaction: add a tunable that decides when memory should be compacted </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> when it should be reclaimed</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f92e2586b43</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mm: compaction: defer compaction </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> an exponential backoff when compaction fails</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="é¡µé¢è¿ç§»" tabindex="-1">é¡µé¢è¿ç§» <a class="header-anchor" href="#é¡µé¢è¿ç§»" aria-label="Permalink to â€œé¡µé¢è¿ç§»â€">â€‹</a></h2><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* pageblock çš„è¿ç§»ç±»å‹ã€‚åŒä¸€ä¸ª pageblock å†…çš„æ‰€æœ‰ page çš„è¿ç§»ç±»å‹ç›¸åŒã€‚ */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> migratetype</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MIGRATE_UNMOVABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MIGRATE_MOVABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MIGRATE_RECLAIMABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MIGRATE_PCPTYPES</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/* the number of types on the pcp lists */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MIGRATE_HIGHATOMIC</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MIGRATE_PCPTYPES,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MIGRATE_CMA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MIGRATE_ISOLATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/* can&#39;t allocate from here */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MIGRATE_TYPES</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> migrate_mode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MIGRATE_ASYNC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MIGRATE_SYNC_LIGHT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MIGRATE_SYNC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>ä¸‰ç§è¿ç§»æ¨¡å¼</p><ul><li><p><code>MIGRATE_ASYNC</code> ç§°ä¹‹ä¸ºâ€œéé˜»å¡è¿ç§»â€æ›´åˆé€‚</p><p>æœ€å¸¸ç”¨ã€‚åœ¨æ­¤æ¨¡å¼ä¸­ä¸ä¼šé˜»å¡ï¼ˆä½†æ˜¯æ—¶é—´ç‰‡åˆ°äº†å¯ä»¥è¿›è¡Œä¸»åŠ¨è°ƒåº¦ï¼‰ï¼Œ ä½¿ç”¨åœºæ™¯ï¼škswapd å†…æ ¸çº¿ç¨‹ä¸­åªä½¿ç”¨å¼‚æ­¥æ¨¡å¼ï¼Œä¸ä¼šä½¿ç”¨åŒæ­¥æ¨¡å¼ã€‚</p><p>åªå¤„ç† MIGRATE_MOVABLE å’Œ MIGRATE_CMA ç±»å‹ä¸­çš„é¡µã€‚ ä¸å¤„ç† MIGRATE_RECLAIMABLE ç±»å‹çš„é¡µæ¡†ï¼Œå› ä¸ºè¿™éƒ¨åˆ†é¡µæ¡†å¾ˆå¤§å¯èƒ½å¯¼è‡´å›å†™ç„¶åé˜»å¡ã€‚//XXX ä¸å¯¹å§ï¼Ÿï¼ŸMIGRATE_RECLAIMABLE å¤§å¤šéƒ½æ˜¯ Slab å•Šï¼Œ MIGRATE_RECLAIMABLE æ˜¯å¯ä»¥å›æ”¶ï¼Œä½†æ˜¯ä¸å¯ä»¥è¿ç§»çš„ï¼Œå› æ­¤è¦å›æ”¶åæ‰èƒ½è¿ç§»ï¼Ÿè€Œå›æ”¶å¯èƒ½ä¼šé˜»å¡ï¼Ÿ</p><p>å¼‚æ­¥æ¨¡å¼ä¸ä¼šå¢åŠ æ¨è¿Ÿè®¡æ•°å™¨é˜€å€¼ã€‚</p></li><li><p><code>MIGRATE_SYNC_LIGHT</code></p><p>è½»åŒæ­¥æ¨¡å¼ã€‚å¤„ç† MIGRATE_MOVABLEã€MIGRATE_CMA å’Œ MIGRATE_RECLAIMABLE ç±»å‹çš„é¡µã€‚//XXX çœŸçš„ä¼šå¤„ç† MIGRATE_RECLAIMABLE å—ï¼Ÿï¼Ÿï¼ŸMIGRATE_RECLAIMABLE ä¼šè¢«è·³è¿‡å§ï¼Œæˆ–è€…æ˜¯å›æ”¶å®Œæˆåä½œä¸ºç©ºé—²é¡µã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼šåœ¨å†…å­˜ä¸è¶³ä»¥åˆ†é…è¿ç»­é¡µæ¡†åå¯¼è‡´å†…å­˜ç¢ç‰‡æ•´ç†æ—¶ï¼Œé¦–å…ˆä¼šè¿›è¡Œå¼‚æ­¥çš„å†…å­˜ç¢ç‰‡æ•´ç†ï¼Œå¦‚æœå¼‚æ­¥çš„å†…å­˜ç¢ç‰‡æ•´ç†åè¿˜æ˜¯ä¸èƒ½å¤Ÿè·å–è¿ç»­çš„é¡µæ¡†(è¿™ç§æƒ…å†µå‘ç”Ÿåœ¨å¾ˆå¤šç¦»æ•£çš„é¡µçš„ç±»å‹æ˜¯ MIGRATE_RECLAIMABLE)ï¼Œå¹¶ä¸” gfp_mask æ˜ç¡®è¡¨ç¤ºä¸å¤„ç†é€æ˜å¤§é¡µçš„æƒ…å†µæˆ–è€…è¯¥è¿›ç¨‹æ˜¯ä¸ªå†…æ ¸çº¿ç¨‹æ—¶ï¼Œåˆ™è¿›è¡Œè½»åŒæ­¥çš„å†…å­˜ç¢ç‰‡æ•´ç†ã€‚</p><p>æ­¤æ¨¡å¼ä¸‹å…è®¸è¿›è¡Œå¤§å¤šæ•°æ“ä½œçš„é˜»å¡ï¼Œæ¯”å¦‚åœ¨ç£ç›˜è®¾å¤‡ç¹å¿™æ—¶ï¼Œé”ç¹å¿™æ—¶ï¼Œæ¯”å¦‚éš”ç¦»äº†å¤ªå¤šé¡µï¼Œéœ€è¦é˜»å¡ç­‰å¾…ä¸€æ®µæ—¶é—´ã€‚ XXX ä¸ºå•¥ä¼šç­‰å¾…ç£ç›˜ï¼Ÿéš”ç¦»äº†å¤ªå¤šé¡µæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ ä½†ä¸ä¼šé˜»å¡ç­‰å¾…æ­£åœ¨å›å†™çš„é¡µç»“æŸï¼Œå¯¹äºæ­£åœ¨å›å†™çš„é¡µç›´æ¥è·³è¿‡ï¼Œä¹Ÿä¸ä¼šå¯¹è„é¡µè¿›è¡Œå›å†™ã€‚ ä¼šå¤„ç†åŒ¿åé¡µå’Œæ–‡ä»¶é¡µï¼Œä½†æ˜¯ä¸ä¼šå¯¹è„æ–‡ä»¶é¡µæ‰§è¡Œå›å†™æ“ä½œï¼Œè€Œå½“å¤„ç†çš„é¡µæ­£åœ¨å›å†™æ—¶ï¼Œä¹Ÿä¸ä¼šç­‰å¾…å…¶å›å†™ç»“æŸã€‚ XXX æˆ‘çš„ç†è§£æ˜¯ï¼šå¹²å‡€çš„æ–‡ä»¶é¡µä¼šç›´æ¥å›æ”¶ï¼Ÿè„çš„æ–‡ä»¶é¡µä¼šè¿›è¡Œè¿ç§»ï¼Ÿï¼ˆä½†å¦‚æœè¯¥è„é¡µåœ¨å†™å›ï¼Œåˆ™ä¼šç›´æ¥è·³è¿‡ï¼Œä¸ç­‰å¾…å›å†™ç»“æŸï¼‰</p><p>è½»åŒæ­¥æ¨¡å¼ä¼šå¢åŠ æ¨è¿Ÿè®¡æ•°å™¨é˜€å€¼ã€‚</p></li><li><p><code>MIGRATE_SYNC</code></p><p>æ‰€æœ‰æ“ä½œéƒ½å¯ä»¥è¿›è¡Œé˜»å¡ï¼Œå¹¶ä¸”ä¼šç­‰å¾…å¤„ç†çš„é¡µå›å†™ç»“æŸï¼Œå¹¶ä¼šå¯¹æ–‡ä»¶é¡µã€åŒ¿åé¡µè¿›è¡Œå›å†™åˆ°ç£ç›˜ï¼Œæ‰€ä»¥å¯¼è‡´æœ€è€—è´¹ç³»ç»Ÿèµ„æºï¼Œå¯¹ç³»ç»Ÿé€ æˆçš„å‹åŠ›æœ€å¤§ã€‚å®ƒä¼šåœ¨ä¸‰ç§æƒ…å†µä¸‹å‘ç”Ÿï¼š</p><ol><li>ä» cma ä¸­åˆ†é…å†…å­˜æ—¶ï¼›</li><li>è°ƒç”¨ alloc_contig_range() å°è¯•åˆ†é…ä¸€æ®µæŒ‡å®šäº†å¼€å§‹é¡µæ¡†å·å’Œç»“æŸé¡µæ¡†å·çš„è¿ç»­é¡µæ¡†æ—¶ï¼›</li><li>é€šè¿‡å†™å…¥ 1 åˆ° sysfs ä¸­çš„/vm/compact_memory æ–‡ä»¶æ‰‹åŠ¨å®ç°åŒæ­¥å†…å­˜ç¢ç‰‡æ•´ç†ã€‚</li></ol></li></ul><p>åœ¨ kswapd ä¸­ï¼Œæ°¸è¿œåªè¿›è¡Œå¼‚æ­¥çš„å†…å­˜ç¢ç‰‡æ•´ç†ï¼Œä¸ä¼šè¿›è¡ŒåŒæ­¥çš„å†…å­˜ç¢ç‰‡æ•´ç†ï¼Œå¹¶ä¸”åœ¨ kswapd ä¸­ä¼šè·³è¿‡æ ‡è®°äº† PB_migrate_skip çš„ pageblockã€‚ ç›¸åï¼Œé kswapd ä¸­çš„å†…å­˜ç¢ç‰‡æ•´ç†ï¼Œå½“æ¨è¿Ÿæ¬¡æ•°è¶…è¿‡äº†æ¨è¿Ÿé˜€å€¼æ—¶ï¼Œä¼šå°† pageblock çš„ PB_migrate_skip æ ‡è®°æ¸…é™¤ï¼Œä¹Ÿå°±æ˜¯ä¼šæ‰«æä¹‹å‰æœ‰ PB_migrate_skip æ ‡è®°çš„ pageblockã€‚ XXX è°ç½®ä¸Š PB_migrate_skip çš„ï¼Ÿ</p><p>åœ¨åŒæ­¥å†…å­˜ç¢ç‰‡æ•´ç†æ—¶ï¼Œä¼šå¿½ç•¥æ‰€æœ‰æ ‡è®°äº† PB_migrate_skip çš„ pageblockï¼Œå¼ºåˆ¶å¯¹è¿™æ®µå†…å­˜ä¸­æ‰€æœ‰ pageblock è¿›è¡Œæ‰«æ(å½“ç„¶é™¤äº† MIGRATE_UNMOVEABLE çš„ pageblock)ã€‚</p><p>åŒ¿åé¡µå¯èƒ½è¢«å½“æˆè„é¡µï¼åŒ¿åé¡µåŠ å…¥åˆ°äº† swapcacheï¼Œä¼šè¢«æ ‡è®°ä¸ºäº†è„é¡µï¼ä¸è¿‡åœ¨å†…å­˜ç¢ç‰‡æ•´ç†æ—¶ï¼Œå³ä½¿åŒ¿åé¡µè¢«æ ‡è®°ä¸ºè„é¡µä¹Ÿä¸ä¼šè¢«å›å†™ï¼Œå®ƒåªæœ‰åœ¨å†…å­˜å›æ”¶æ—¶æ‰ä¼šå¯¹è„åŒ¿åé¡µè¿›è¡Œå›å†™åˆ° swap åˆ†åŒºã€‚åœ¨è„åŒ¿åé¡µè¿›è¡Œå›å†™åˆ° swap åˆ†åŒºåï¼ŒåŸºæœ¬ä¸Šæ­¤åŒ¿åé¡µå ç”¨çš„é¡µæ¡†ä¹Ÿå¿«è¢«é‡Šæ”¾åˆ°ä¼™ä¼´ç³»ç»Ÿä¸­ä½œä¸ºç©ºé—²é¡µæ¡†äº†ã€‚</p><h2 id="ç¢ç‰‡æ•´ç†è¿‡ç¨‹" tabindex="-1">ç¢ç‰‡æ•´ç†è¿‡ç¨‹ <a class="header-anchor" href="#ç¢ç‰‡æ•´ç†è¿‡ç¨‹" aria-label="Permalink to â€œç¢ç‰‡æ•´ç†è¿‡ç¨‹â€">â€‹</a></h2><p>å†…å­˜ç¢ç‰‡æ•´ç†æ˜¯ä»¥ zone ä¸ºå•ä½çš„ï¼Œè€Œ zone ä¸­åˆä»¥ pageblock ä¸ºå•ä½ã€‚åœ¨å†…å­˜ç¢ç‰‡æ•´ç†å¼€å§‹å‰ï¼Œä¼šåœ¨ zone çš„å¤´å’Œå°¾å„è®¾ç½®ä¸€ä¸ªæŒ‡é’ˆï¼Œå¤´æŒ‡é’ˆä»å¤´å‘å°¾æ‰«æå¯ç§»åŠ¨çš„é¡µï¼Œè€Œå°¾æŒ‡é’ˆä»å°¾å‘å¤´æ‰«æç©ºé—²çš„é¡µï¼Œå½“ä»–ä»¬ç›¸é‡æ—¶ç»ˆæ­¢æ•´ç†ã€‚</p><ol><li>å¤´æŒ‡é’ˆæ¯æ¬¡æ‰«æä¸€ä¸ªç¬¦åˆè¦æ±‚çš„ pageblock é‡Œçš„æ‰€æœ‰çš„å¯ç§»åŠ¨çš„æ­£åœ¨ä½¿ç”¨çš„é¡µæ¡†ã€‚ â€œç¬¦åˆè¦æ±‚â€æ˜¯æŒ‡ï¼špageblock æ˜¯ MIGRATE_MOVABLEã€MIGRATE_CMAã€MIGRATE_RECLAIMABLE ç±»å‹ï¼Œä¸æ˜¯è¿™äº›ç±»å‹æ—¶ï¼Œåˆ™ä¼šè·³è¿‡ï¼Œæ¯”å¦‚ MIGRATE_UNMOVABLE pageblockã€‚</li><li>å½“æ‰«æå®Œè¿™ä¸ª pageblock åæœ‰å¯ç§»åŠ¨çš„é¡µæ¡†æ—¶ï¼Œä¼šå˜ä¸ºå°¾æŒ‡é’ˆä»¥ pageblock ä¸ºå•ä½æ‰«æå¯ç§»åŠ¨é¡µæ¡†æ•°é‡çš„ç©ºé—²é¡µæ¡†ï¼Œåœ¨ pageblock ä¸­ä¹Ÿæ˜¯ä»å¼€å§‹é¡µæ¡†å‘ç»“æŸé¡µæ¡†è¿›è¡Œæ‰«æã€‚</li><li>æœ€åä¼šå°†å¤´æŒ‡é’ˆæ‰«æåˆ°çš„å¯ç§»åŠ¨é¡µæ¡†å†…å®¹å¤åˆ¶åˆ°å°¾æŒ‡é’ˆæ‰«æåˆ°çš„ç©ºé—²é¡µæ¡†ä¸­ã€‚</li><li>ç„¶åé‡å¤ 1 2 3 æ­¥ï¼Œç›´åˆ°å¤´å°¾æŒ‡é’ˆç›¸é‡ã€‚</li></ol><hr><p><strong>å†…å­˜ç¢ç‰‡æ•´ç†å‘ç”Ÿæ—¶æœº</strong></p><ol><li>ä¼™ä¼´ç³»ç»Ÿåˆ†é…å†…å­˜ï¼Œè¿›å…¥æ…¢é€Ÿåˆ†é…æµç¨‹ <code>__alloc_pages_slowpath()</code>ï¼Œè‹¥é™ä½ watermak å€¼å’Œè¿›è¡Œ kswap å†…å­˜å›æ”¶æ“ä½œåï¼Œç³»ç»Ÿå†…å­˜ä»ç„¶åƒç´§ï¼Œåˆ™ä¼™ä¼´ç³»ç»Ÿä¼šè§¦å‘ memory-compactionã€‚</li><li>å½“éœ€è¦ä»æŒ‡å®šåœ°æ–¹è·å–è¿ç»­é¡µæ¡†ï¼Œä½†æ˜¯ä¸­é—´æœ‰é¡µæ¡†æ­£åœ¨ä½¿ç”¨æ—¶ã€‚ï¼ˆæ¯”å¦‚æŒ‡å®šåˆ†é… ZONE_CMA ä¸­çš„æŸæ®µå†…å­˜?ï¼‰</li><li>å› ä¸ºå†…å­˜çŸ­ç¼ºå¯¼è‡´ kswapd è¢«å”¤é†’æ—¶ï¼Œåœ¨è¿›è¡Œå†…å­˜å›æ”¶ä¹‹åä¼šè¿›è¡Œå†…å­˜ç¢ç‰‡æ•´ç†ã€‚</li><li>å†…å­˜åƒç´§å¯¼è‡´ kcompactd çº¿ç¨‹å”¤é†’è§¦å‘å†…å­˜ç¢ç‰‡æ•´ç†ï¼Ÿ</li><li>æ‰‹åŠ¨è§¦å‘ã€‚ <code>echo 1 &gt; /sys/devices/system/node/nodexx/compact</code> å¯¹æŸä¸ª node ä¸Šçš„ zone è¿›è¡Œå†…å­˜ç¢ç‰‡æ•´ç†ï¼Œæˆ– <code>echo 1 &gt; /proc/sys/vm/compact_memory</code> å¯¹æ‰€æœ‰ zone è¿›è¡Œå†…å­˜ç¢ç‰‡æ•´ç†ã€‚</li></ol><p><strong>ç³»ç»Ÿåˆ¤å®šæ˜¯å¦æ‰§è¡Œå†…å­˜ç¢ç‰‡æ•´ç†çš„æ ‡å‡†</strong></p><ol><li>åœ¨åˆ†é…é¡µæ¡†è¿‡ç¨‹ä¸­ï¼Œzone æ˜¾ç¤ºæ˜¯æœ‰è¶³å¤Ÿçš„ç©ºé—²é¡µæ¡†ä¾›äºæœ¬æ¬¡åˆ†é…çš„ï¼Œä½†æ˜¯ä¼™ä¼´ç³»ç»Ÿé“¾è¡¨ä¸­åˆæ²¡æœ‰è¿ç»­é¡µæ¡†æ®µç”¨äºæœ¬æ¬¡åˆ†é…ã€‚åŸå› å°±æ˜¯è¿‡å¤šåˆ†æ•£çš„ç©ºé—²é¡µæ¡†ï¼Œå®ƒä»¬æ²¡åŠæ³•ç»„æˆä¸€å—è¿ç»­é¡µæ¡†å­˜æ”¾åœ¨ä¼™ä¼´ç³»ç»Ÿçš„é“¾è¡¨ä¸­ã€‚</li><li>åœ¨ kswapd å”¤é†’åä¼šå¯¹ zone çš„é¡µæ¡†é˜€å€¼è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœå¯ç”¨é¡µæ¡†å°‘äºé«˜é˜€å€¼åˆ™ä¼šè¿›è¡Œå†…å­˜å›æ”¶ï¼Œæ¯æ¬¡è¿›è¡Œå†…å­˜å›æ”¶ä¹‹åä¼šè¿›è¡Œå†…å­˜ç¢ç‰‡æ•´ç†ã€‚</li></ol><p>å³ä½¿æ»¡è¶³æ ‡å‡†ï¼Œä¹Ÿä¸ä¸€å®šä¼šæ‰§è¡Œå†…å­˜ç¢ç‰‡æ•´ç†ï¼Œå…·ä½“è§åé¢çš„å†…å­˜ç¢ç‰‡æ•´ç†æ¨è¿Ÿå’Œ compact_zone()å‡½æ•°ã€‚</p><p><strong>å†…å­˜ç¢ç‰‡æ•´ç†ç»“æŸæ—¶æœº</strong></p><p>åœ¨å†…å­˜ç¢ç‰‡æ•´ç†ä¸­ï¼Œä¸€æ¬¡ zone çš„å†…å­˜ç¢ç‰‡æ•´ç†ç»“æŸæ¡ä»¶æœ‰ä¸‰æ¡ï¼š</p><ol><li>å¯ç§»åŠ¨é¡µæ¡†æ‰«æçš„ä½ç½®æ˜¯å¦å·²ç»è¶…è¿‡äº†ç©ºé—²é¡µæ¡†æ‰«æçš„ä½ç½®ï¼Œè¶…è¿‡åˆ™ç»“æŸæ•´ç†ï¼Œå¹¶ä¸”ä¼šé‡ç½® zone-&gt;compact_cached_free_pfn å’Œ zone-&gt;compact_cached_migrate_pfnï¼Œå¹¶ä¸”ä¸æ˜¯ kswap æ—¶ï¼Œä¼šè®¾ç½® zone-&gt;compact_blockskip_flush ä¸ºçœŸ</li><li>zone çš„ç©ºé—²é¡µæ¡†æ•°é‡æ»¡è¶³äº†æ¡ä»¶ï¼šzone çš„ low é˜€å€¼ + æ­¤æ¬¡è¦åˆ†é…çš„é¡µé¢æ•°(1 &lt;&lt; order) + zone çš„ä¿ç•™é¡µæ¡†æ•°ã€‚</li><li>åˆ¤æ–­ä¼™ä¼´ç³»ç»Ÿä¸­æ˜¯å¦æœ‰æ¯” order å€¼å¤§çš„ç©ºé—²è¿ç»­é¡µæ¡†å—ï¼Œæœ‰åˆ™ç»“æŸæ•´ç†ï¼Œå¦‚æœ order ä¸º-1ï¼Œåˆ™å¿½ç•¥æ­¤æ¡ä»¶</li></ol><p>ä¸è¿‡æœ‰ä¾‹å¤–ï¼Œé€šè¿‡å†™å…¥åˆ° /proc/sys/vm/compact_memory è¿›è¡Œå¼ºåˆ¶å†…å­˜ç¢ç‰‡æ•´ç†çš„æƒ…å†µï¼Œåˆ™åˆ¤æ–­æ¡ä»¶åªæœ‰ç¬¬ 1 æ¡ã€‚å¯¹äº zone æ¥è¯´ï¼Œå¯ç§»åŠ¨é¡µæ‰«æå’Œç©ºé—²é¡µæ‰«æäº¤æ±‡ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ç§æƒ…å†µæ—¶ï¼Œæ‰ç®—æ˜¯å¯¹ zone è¿›è¡Œäº†ä¸€æ¬¡å®Œæ•´çš„å†…å­˜ç¢ç‰‡æ•´ç†ï¼Œè¿™ä¸ªå®Œæ•´çš„å†…å­˜ç¢ç‰‡æ•´ç†å¹¶ä¸ä»£è¡¨ä¸€æ¬¡å†…å­˜ç¢ç‰‡æ•´ç†å°±èƒ½å®ç°ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å¯¹ zone è¿›è¡Œå¤šæ¬¡å†…å­˜ç¢ç‰‡æ•´ç†æ‰è¾¾åˆ°çš„ï¼Œå› ä¸ºæ¯æ¬¡å†…å­˜ç¢ç‰‡æ•´ç†ç»“æŸæ—¶æœºè¿˜æœ‰å¦å¤–ä¸¤ç§ã€‚å½“ zone è¾¾åˆ°ä¸€æ¬¡å®Œæ•´çš„å†…å­˜ç¢ç‰‡æ•´ç†æ—¶ï¼Œä¼šé‡ç½®ä¸¤ä¸ªæ‰«æçš„èµ·å§‹ä¸º zone çš„ç¬¬ä¸€ä¸ªé¡µå’Œæœ€åä¸€ä¸ªé¡µï¼Œå¹¶ä¸”ä¸æ˜¯å¤„äº kswap ä¸­æ—¶ï¼Œä¼šè®¾ç½® zone-&gt;compact_blockskip_flush ä¸ºçœŸï¼Œè¿™ä¸ª zone-&gt;compact_blockskip_flush åœ¨ kswapd å‡†å¤‡ç¡çœ æ—¶ï¼Œä¼šå°† zone çš„æ‰€æœ‰ pageblock çš„ PB_migrate_skip æ ‡å¿—æ¸…é™¤ã€‚</p><hr><p><strong>å†…å­˜ç¢ç‰‡æ•´ç†æ¨è¿Ÿæœºåˆ¶</strong></p><p>ä¸ºä»€ä¹ˆè¦æ¨è¿Ÿï¼Ÿ ç­”ï¼šå†…å­˜ç¢ç‰‡æ•´ç†æ˜¯ä¸€ä¸ªç›¸å½“è€—è´¹èµ„æºçš„äº‹æƒ…ï¼Œå®ƒå¹¶ä¸ä¼šç»å¸¸ä¼šæ‰§è¡Œï¼Œå³ä½¿å› ä¸ºå†…å­˜çŸ­ç¼ºå¯¼è‡´ä»£ç ä¸­ç»å¸¸è°ƒç”¨åˆ°å†…å­˜ç¢ç‰‡æ•´ç†å‡½æ•°ï¼Œå®ƒä¹Ÿä¼šæ ¹æ®è°ƒç”¨æ¬¡æ•°é€‰æ‹©æ€§åœ°å¿½ç•¥ä¸€äº›æ‰§è¡Œè¯·æ±‚ã€‚</p><p>å…·ä½“ç‚¹ï¼Œå†…å­˜ç¢ç‰‡æ•´ç†è™½ç„¶æ˜¯é’ˆå¯¹æ¯ä¸ª zone çš„ï¼Œä½†æ˜¯æ‰§è¡Œçš„æ—¶å€™ä¼ å…¥çš„æ˜¯ä¸€ä¸ª zonelistï¼Œè¿™æ ·å°±ä¼šæœ‰ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯å¯èƒ½æŸä¸ª zone åˆšè¿›è¡Œè¿‡å†…å­˜ç¢ç‰‡æ•´ç†ï¼Œè€Œç³»ç»Ÿå› ä¸ºå†…å­˜ä¸è¶³åˆè¿›è¡Œäº†å†…å­˜ç¢ç‰‡æ•´ç†ï¼Œå¯¼è‡´è¿™ä¸ªåˆšè¿›è¡Œå†…å­˜ç¢ç‰‡æ•´ç†çš„ zone åˆè¦æ‰§è¡Œå†…å­˜ç¢ç‰‡æ•´ç†ï¼Œä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå†…æ ¸ä¼šä¸ºæ¯ä¸ª zone åšä¸€ä¸ªæ•´ç†æ¨è¿Ÿè®¡æ•°ï¼Œè¿™ä¸ªè®¡æ•°æ˜¯æ¯ä¸ª zone éƒ½ä¼šæœ‰çš„ã€‚</p><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> zone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/* ç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦æ¨è¿Ÿï¼Œæ¯æ¬¡æ¨è¿Ÿä¼š ++ï¼Œå¦‚æœè¶…è¿‡äº† 1 &lt;&lt; compact_defer_shift åˆ™è¿›è¡Œæ•´ç† */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		compact_considered;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/* åªæœ‰åœ¨åŒæ­¥å’Œè½»åŒæ­¥æ¨¡å¼ä¸‹è¿›è¡Œå†…å­˜ç¢ç‰‡æ•´ç†åï¼Œzone çš„ç©ºé—²é¡µæ¡†æ•°é‡æ²¡è¾¾åˆ° (lowé˜€å€¼ + 1&lt;&lt;order + ä¿ç•™å†…å­˜) æ—¶ï¼Œæ‰ä¼š ++ */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		compact_defer_shift;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/* å°è¯•ç¢ç‰‡æ•´ç†æ—¶çš„ order &gt;= compact_order_failed æ—¶ï¼Œå¹¶ä¸”æ²¡è¶…è¿‡æ¨è¿Ÿè®¡æ•°é˜ˆå€¼ï¼Œå°±ä¼šæ¨è¿Ÿï¼Œå¦åˆ™ï¼Œå°±è¿›è¡Œæ•´ç†ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * å¦‚æœ order &gt;= compact_order_failed æ—¶ï¼Œæ•´ç†æˆåŠŸï¼Œå°±å°†æ­¤å€¼è®¾ç½®ä¸º order+1ï¼Œè¡¨æ˜å¦‚æœç”³è¯· order+1 å¯èƒ½ä¼šå¤±è´¥ã€‚*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			compact_order_failed;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>åœ¨ zone æ‰§è¡Œå†…å­˜ç¢ç‰‡æ•´ç†åï¼Œå¦‚æœæˆåŠŸä»æ­¤ zone ä¸­åˆ†é…åˆ°äº† order å†…å­˜ï¼Œå°±ä¼šé‡ç½® compact_considered å’Œ compact_defer_shift</p><hr><p><strong>å†…å­˜ç¢ç‰‡æ•´ç†æ‰«æèµ·å§‹ä½ç½®ä¸ pageblock çš„è·³è¿‡</strong></p><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> zone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/* ç©ºé—²é¡µæ¡†æ‰«æèµ·å§‹ä½ç½®ï¼Œå¼€å§‹è®¾ç½®æ—¶æ˜¯ç®¡ç†åŒºçš„æœ€åä¸€ä¸ªé¡µæ¡†ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * åœ¨å†…å­˜ç¢ç‰‡æ•´ç†æ‰«æå¯ä»¥ç§»åŠ¨çš„é¡µæ—¶ï¼Œä»æœ¬æ¬¡å†…å­˜ç¢ç‰‡æ•´ç†å¼€å§‹åˆ°æ­¤pageblockç»“æŸéƒ½æ²¡æœ‰éš”ç¦»å‡ºå¯ç§»åŠ¨é¡µæ—¶ï¼Œä¼šå°†æ­¤å€¼è®¾ç½®ä¸ºpageblockçš„æœ€åä¸€é¡µã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * æ­¤å€¼é»˜è®¤æ˜¯zoneçš„ç»“æŸé¡µæ¡†ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		compact_cached_free_pfn;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/* 0ç”¨äºå¼‚æ­¥ï¼Œ1ç”¨äºåŒæ­¥ï¼Œç”¨äºä¿å­˜ç®¡ç†åŒºå¯ç§»åŠ¨é¡µæ¡†æ‰«æèµ·å§‹ä½ç½®ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * åœ¨å†…å­˜ç¢ç‰‡æ•´ç†æ‰«æç©ºé—²é¡µæ—¶ï¼Œä»æœ¬æ¬¡å†…å­˜ç¢ç‰‡æ•´ç†å¼€å§‹åˆ°æ­¤pageblockç»“æŸéƒ½æ²¡æœ‰éš”ç¦»å‡ºç©ºé—²é¡µæ—¶ï¼Œä¼šå°†æ­¤å€¼è®¾ç½®ä¸ºpageblockçš„æœ€åä¸€é¡µã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * æ­¤å€¼é»˜è®¤æ˜¯zoneçš„å¼€å§‹é¡µæ¡†ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		compact_cached_migrate_pfn[ASYNC_AND_SYNC];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		compact_init_migrate_pfn;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		compact_init_free_pfn;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>å¯¹ä¸€ä¸ª pageblock è¿›è¡Œæ‰«æåï¼Œå¦‚æœæ— æ³•ä»æ­¤ pageblock éš”ç¦»å‡ºä¸€ä¸ªè¦æ±‚çš„é¡µæ¡†ï¼Œè¿™æ—¶å€™å°±ä¼šå°†æ­¤ pageblock æ ‡è®°ä¸ºè·³è¿‡ï¼Œä¸»è¦é€šè¿‡è®¾ç½® pageblock åœ¨ zone çš„ pageblock ä½å›¾ä¸­çš„ PB_migrate_skip æ ‡å¿—å®ç°çš„ã€‚è€Œæ ‡è®°ä¹‹åä¼šæœ‰ä¸¤ç§æƒ…å†µï¼š</p><ol><li>æœ¬æ¬¡å†…å­˜ç¢ç‰‡æ•´ç†åœ¨ä¹‹å‰çš„ pageblock å·²ç»éš”ç¦»å‡ºäº†æ­¤ç§é¡µæ¡†(å¯ç§»åŠ¨é¡µ/ç©ºé—²é¡µ)ï¼Œè¿™ç§æƒ…å†µå°±æ˜¯è®¾ç½® pageblock çš„ PB_migrate_skip æ ‡è®°ã€‚</li><li>æœ¬æ¬¡å†…å­˜ç¢ç‰‡æ•´ç†åœ¨ä¹‹å‰çš„ pageblock ä¸­æ²¡æœ‰éš”ç¦»å‡ºè¿‡æ­¤ç§é¡µæ¡†(å¯ç§»åŠ¨é¡µ/ç©ºé—²é¡µ)ï¼Œè¯´æ˜ä¹‹å‰çš„ pageblock éƒ½è¢«æ ‡è®°äº†è·³è¿‡ï¼Œè¿™ç§æƒ…å†µä¸æ­¢è®¾ç½® pageblock çš„ PB_migrate_skip æ ‡è®°ï¼Œè¿˜ä¼šè®¾ç½®å¯¹äºçš„å†…å­˜ç¢ç‰‡æ•´ç†æ‰«æèµ·å§‹ä½ç½®ã€‚</li></ol><p>å¯¹äºç¬¬äºŒç§æƒ…å†µï¼Œä»¥æ‰«æå¯ç§»åŠ¨é¡µä¸ºä¾‹å­ï¼Œæœ¬æ¬¡å†…å­˜ç¢ç‰‡æ•´ç†å¯ç§»åŠ¨é¡µæ‰«ææ˜¯ä» zone çš„ç¬¬ä¸€ä¸ªé¡µæ¡†å¼€å§‹ï¼Œæ‰«æå®Œä¸€ä¸ª pageblock åï¼Œæ²¡æœ‰éš”ç¦»å‡ºå¯ç§»åŠ¨é¡µæ¡†ï¼Œåˆ™æ ‡è®°æ­¤ pageblock çš„è·³è¿‡æ ‡è®° PB_migrate_skipï¼Œç„¶åå°† zone-&gt;compact_cached_migrate_pfn è®¾ç½®ä¸ºæ­¤ pageblock çš„ç»“æŸé¡µæ¡†ï¼Œè¿™æ ·ï¼Œåœ¨ä¸‹æ¬¡å¯¹æ­¤ zone è¿›è¡Œå†…å­˜ç¢ç‰‡æ•´ç†æ—¶ï¼Œå°±ä¼šç›´æ¥ä»æ­¤ pageblock çš„ä¸‹ä¸€ä¸ª pageblock å¼€å§‹ï¼ŒæŠŠæ­¤ pageblock è·³è¿‡äº†ã€‚åŒç†ï¼Œå¯¹äºç©ºé—²é¡µæ‰«æä¹Ÿæ˜¯ä¸€æ ·ã€‚</p><h2 id="kswapd" tabindex="-1">kswapd <a class="header-anchor" href="#kswapd" aria-label="Permalink to â€œkswapdâ€">â€‹</a></h2><p>è¯¦è§ <a href="./swap">swap</a></p><h2 id="æ•°æ®ç»“æ„" tabindex="-1">æ•°æ®ç»“æ„ <a class="header-anchor" href="#æ•°æ®ç»“æ„" aria-label="Permalink to â€œæ•°æ®ç»“æ„â€">â€‹</a></h2><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * Determines how hard direct compaction should try to succeed.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * Lower value means higher priority, analogically to reclaim priority.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 1. ä¼˜å…ˆçº§å…³ç³»:  COMPACT_PRIO_SYNC_FULL &gt;  COMPACT_PRIO_SYNC_LIGHT &gt; COMPACT_PRIO_ASYNC</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 2. compationå¯¹åº”çš„æˆæœ¬ï¼šCOMPACT_PRIO_SYNC_FULL &gt;  COMPACT_PRIO_SYNC_LIGHT &gt; COMPACT_PRIO_ASYNC</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 3. COMPACT_PRIO_SYNC_FULLå®Œå…¨åŒæ­¥æˆåŠŸç‡æœ€é«˜</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> compact_priority</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// æ•´ä¸ªå†…å­˜è§„æ•´ä»¥åŒæ­¥æ–¹å¼å®Œæˆï¼ˆå…è®¸é˜»å¡ï¼Œå…è®¸å°†è„é¡µå†™å›åˆ°å­˜å‚¨è®¾å¤‡ä¸Šï¼Œç›´åˆ°ç­‰å¾…å®Œæˆï¼‰</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	COMPACT_PRIO_SYNC_FULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MIN_COMPACT_PRIORITY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPACT_PRIO_SYNC_FULL,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// è½»é‡çº§åŒæ­¥æ¨¡å¼ï¼Œå…è®¸ç»å¤§å¤šæ•°ç¥–å¡ï¼Œä½†æ˜¯ä¸å…è®¸å°†è„é¡µå†™å›åˆ°å­˜å‚¨è®¾å¤‡ä¸Šï¼Œå› ä¸ºç­‰å¾…æ—¶é—´æ¯”è¾ƒé•¿</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	COMPACT_PRIO_SYNC_LIGHT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MIN_COMPACT_COSTLY_PRIORITY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPACT_PRIO_SYNC_LIGHT,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	DEF_COMPACT_PRIORITY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPACT_PRIO_SYNC_LIGHT,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// æ•´ä¸ªå†…å­˜è§„æ•´æ“ä½œä»¥å¼‚æ­¥æ–¹å¼å¤„ç†ï¼Œä¸å…è®¸é˜»å¡</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	COMPACT_PRIO_ASYNC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	INIT_COMPACT_PRIORITY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPACT_PRIO_ASYNC</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * MIGRATE_ASYNC means never block</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * MIGRATE_SYNC_LIGHT in the current implementation means to allow blocking</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *	on most operations but not -&gt;writepage as the potential stall time</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *	is too significant</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * MIGRATE_SYNC will block when migrating pages</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> migrate_mode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * å†…å­˜ç¢ç‰‡æ•´ç†æœ€å¸¸ç”¨çš„æ¨¡å¼ï¼ˆé»˜è®¤åˆå§‹æ˜¯å¼‚æ­¥æ¨¡å¼ï¼‰ï¼Œåœ¨æ­¤æ¨¡å¼ä¸­ä¸ä¼šè¿›è¡Œé˜»å¡(ä½†æ˜¯æ—¶é—´ç‰‡åˆ°äº†å¯ä»¥è¿›è¡Œä¸»åŠ¨è°ƒ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * åº¦)ï¼Œä¹Ÿå°±æ˜¯æ­¤ç§æ¨¡å¼ä¸ä¼šå¯¹æ–‡ä»¶é¡µè¿›è¡Œå¤„ç†ï¼Œæ–‡ä»¶é¡µç”¨äºæ˜ å°„æ–‡ä»¶æ•°æ®ä½¿ç”¨ï¼Œè¿™ç§æ¨¡å¼ä¹Ÿæ˜¯å¯¹æ•´ä½“ç³»ç»Ÿå‹åŠ›è¾ƒå°</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * çš„æ¨¡å¼ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MIGRATE_ASYNC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * å½“å¼‚æ­¥æ¨¡å¼æ•´ç†ä¸äº†æ›´å¤šå†…å­˜æ—¶ï¼Œæœ‰ä¸¤ç§æƒ…å†µä¸‹ä¼šä½¿ç”¨è½»åŒæ­¥æ¨¡å¼å†æ¬¡æ•´ç†å†…å­˜ï¼š1.æ˜ç¡®è¡¨ç¤ºåˆ†é…çš„ä¸æ˜¯é€æ˜å¤§</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * é¡µçš„æƒ…å†µä¸‹ï¼›2.å½“å‰è¿›ç¨‹æ˜¯å†…æ ¸çº¿ç¨‹çš„æƒ…å†µä¸‹ã€‚è¿™ä¸ªæ¨¡å¼ä¸­å…è®¸å¤§å¤šæ•°æ“ä½œè¿›è¡Œé˜»å¡(æ¯”å¦‚éš”ç¦»äº†å¤ªå¤šé¡µï¼Œéœ€è¦é˜»</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * å¡ç­‰å¾…ä¸€æ®µæ—¶é—´)ã€‚è¿™ç§æ¨¡å¼ä¼šå¤„ç†åŒ¿åé¡µå’Œæ–‡ä»¶é¡µï¼Œä½†æ˜¯ä¸ä¼šå¯¹è„æ–‡ä»¶é¡µæ‰§è¡Œå›å†™æ“ä½œï¼Œè€Œå½“å¤„ç†çš„é¡µæ­£åœ¨å›å†™</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * æ—¶ï¼Œä¹Ÿä¸ä¼šç­‰å¾…å…¶å›å†™ç»“æŸã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MIGRATE_SYNC_LIGHT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * æ‰€æœ‰æ“ä½œéƒ½å¯ä»¥è¿›è¡Œé˜»å¡ï¼Œå¹¶ä¸”ä¼šç­‰å¾…å¤„ç†çš„é¡µå›å†™ç»“æŸï¼Œå¹¶ä¼šå¯¹æ–‡ä»¶é¡µã€åŒ¿åé¡µè¿›è¡Œå›å†™åˆ°ç£ç›˜ï¼Œæ‰€ä»¥å¯¼è‡´æœ€</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * è€—è´¹ç³»ç»Ÿèµ„æºï¼Œå¯¹ç³»ç»Ÿé€ æˆçš„å‹åŠ›æœ€å¤§ã€‚å®ƒä¼šåœ¨ä¸‰ç§æƒ…å†µä¸‹å‘ç”Ÿï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * 	1. ä»cmaä¸­åˆ†é…å†…å­˜æ—¶ï¼›</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * 	2. è°ƒç”¨alloc_contig_range()å°è¯•åˆ†é…ä¸€æ®µæŒ‡å®šäº†å¼€å§‹é¡µæ¡†å·å’Œç»“æŸé¡µæ¡†å·çš„è¿ç»­é¡µæ¡†æ—¶ï¼›</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * 	3. é€šè¿‡å†™å…¥1åˆ°sysfsä¸­çš„/vm/compact_memoryæ–‡ä»¶æ‰‹åŠ¨å®ç°åŒæ­¥å†…å­˜ç¢ç‰‡æ•´ç†ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * åŒæ­¥æ¨¡å¼ä¼šå¢åŠ æ¨è¿Ÿè®¡æ•°å™¨é˜€å€¼ï¼Œå¹¶ä¸”åœ¨åŒæ­¥æ¨¡å¼ä¸‹ï¼Œä¼šè®¾ç½®å¥½compact_controlï¼Œè®©åŒæ­¥æ¨¡å¼æ—¶å¿½ç•¥</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * pageblockçš„PB_migrate_skipæ ‡è®°</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MIGRATE_SYNC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> migrate_reason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MR_COMPACTION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MR_MEMORY_FAILURE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MR_MEMORY_HOTPLUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MR_SYSCALL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		/* also applies to cpusets */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MR_MEMPOLICY_MBIND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MR_NUMA_MISPLACED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MR_CONTIG_RANGE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MR_LONGTERM_PIN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MR_DEMOTION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MR_DAMON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	MR_TYPES</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><p>å†…å­˜è§„æ•´(compact)ä¸­ä¼šè°ƒç”¨ migrate_pages()ï¼ŒåŒæ—¶ä¹Ÿä¼šè®¾ç½®è¿ç§»æ¨¡å¼(ä½äº compact_control-&gt;mode)ã€‚ è‹¥æ˜¯ sysfs ä¸»åŠ¨è§¦å‘çš„å†…å­˜è§„æ•´ä¼šç”¨ MIGRATE_SYNC æ¨¡å¼ï¼› è‹¥æ˜¯ kcompactd è§¦å‘çš„è§„æ•´ä¼šç”¨ MIGRATE_SYNC_LIGHT æ¨¡å¼ï¼› è‹¥æ˜¯å†…å­˜åˆ†é… slowpath ä¸­è§¦å‘çš„ä¼šæ ¹æ® compact prior å»è®¾ç½®ç”¨ MIGRATE_ASYNC æˆ– MIGRATE_SYNC_LIGHT æ¨¡å¼ã€‚</p><p>åœ¨å†…å­˜ä¸è¶³ä»¥åˆ†é…è¿ç»­é¡µæ¡†åå¯¼è‡´å†…å­˜ç¢ç‰‡æ•´ç†æ—¶ï¼Œé¦–å…ˆä¼šè¿›è¡Œå¼‚æ­¥çš„å†…å­˜ç¢ç‰‡æ•´ç†ï¼Œå¦‚æœå¼‚æ­¥çš„å†…å­˜ç¢ç‰‡æ•´ç†åè¿˜æ˜¯ä¸èƒ½å¤Ÿè·å–è¿ç»­çš„é¡µæ¡†(è¿™ç§æƒ…å†µå‘ç”Ÿåœ¨å¾ˆå¤šç¦»æ•£çš„é¡µçš„ç±»å‹æ˜¯ MIGRATE_RECLAIMABLE)ï¼Œå¹¶ä¸” gfp_mask æ˜ç¡®è¡¨ç¤ºä¸å¤„ç†é€æ˜å¤§é¡µçš„æƒ…å†µæˆ–è€…è¯¥è¿›ç¨‹æ˜¯ä¸ªå†…æ ¸çº¿ç¨‹æ—¶ï¼Œåˆ™è¿›è¡Œè½»åŒæ­¥çš„å†…å­˜ç¢ç‰‡æ•´ç†ã€‚</p><p>åœ¨ kswapd ä¸­ï¼Œæ°¸è¿œåªè¿›è¡Œå¼‚æ­¥çš„é¡µé¢è¿ç§»ï¼Œä¸ä¼šè¿›è¡ŒåŒæ­¥çš„é¡µé¢è¿ç§»ï¼Œå¹¶ä¸”åœ¨ kswapd ä¸­ä¼šè·³è¿‡æ ‡è®°äº† PB_migrate_skip çš„ pageblockã€‚ç›¸åé kswapd ä¸­çš„é¡µé¢è¿ç§»ï¼Œå½“æ¨è¿Ÿæ¬¡æ•°è¶…è¿‡äº†æ¨è¿Ÿé˜€å€¼æ—¶ï¼Œä¼šå°† pageblock çš„ PB_migrate_skip æ ‡è®°æ¸…é™¤ï¼Œä¹Ÿå°±æ˜¯ä¼šæ‰«æä¹‹å‰æœ‰ PB_migrate_skip æ ‡è®°çš„ pageblockã€‚</p><p>åœ¨åŒæ­¥é¡µé¢è¿ç§»æ—¶ï¼Œä¼šå¿½ç•¥æ‰€æœ‰æ ‡è®°äº† PB_migrate_skip çš„ pageblockï¼Œå¼ºåˆ¶å¯¹è¿™æ®µå†…å­˜ä¸­æ‰€æœ‰ pageblock è¿›è¡Œæ‰«æ(å½“ç„¶é™¤äº† MIGRATE_UNMOVEABLE çš„ pageblock)ã€‚</p><ul><li>å¼‚æ­¥æ˜¯ç”¨å¾—æœ€å¤šçš„ï¼Œå®ƒæ•´ç†çš„é€Ÿåº¦æœ€å¿«ï¼Œå› ä¸ºå®ƒåªå¤„ç† MIGRATE_MOVABLE å’Œ MIGRATE_CMA ä¸¤ç§ç±»å‹ï¼Œå¹¶ä¸”ä¸å¤„ç†è„é¡µå’Œé˜»å¡çš„æƒ…å†µï¼Œé‡åˆ°éœ€è¦é˜»å¡çš„æƒ…å†µå°±è¿”å›ã€‚</li><li>è€Œè½»åŒæ­¥çš„æƒ…å†µæ˜¯åœ¨å¼‚æ­¥æ— æ³•æœ‰æ•ˆçš„æ•´ç†è¶³å¤Ÿå†…å­˜æ—¶ä½¿ç”¨ï¼Œå®ƒä¼šå¤„ç† MIGRATE_RECLAIMABLEã€MIGRATE_MOVABLEã€MIGRATE_CMA ä¸‰ç§ç±»å‹çš„é¡µæ¡†ï¼Œåœ¨ä¸€äº›é˜»å¡æƒ…å†µä¹Ÿä¼šç­‰å¾…é˜»å¡å®Œæˆ(æ¯”å¦‚ç£ç›˜è®¾å¤‡å›å†™ç¹å¿™ï¼Œå¾…ç§»åŠ¨çš„é¡µæ­£åœ¨å›å†™)ï¼Œä½†æ˜¯å®ƒä¸ä¼šå¯¹è„æ–‡ä»¶é¡µè¿›è¡Œå›å†™æ“ä½œã€‚</li><li>åŒæ­¥æ•´ç†çš„æƒ…å†µå°±æ˜¯åœ¨è½»åŒæ­¥çš„åŸºç¡€ä¸Šä¼šå¯¹è„æ–‡ä»¶é¡µè¿›è¡Œå›å†™æ“ä½œã€‚</li></ul><p>è¿™é‡Œéœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œéæ–‡ä»¶æ˜ å°„é¡µä¹Ÿæ˜¯æœ‰å¯èƒ½è¢«å½“æˆè„é¡µçš„ï¼Œå½“å®ƒåŠ å…¥ swapcache åä¼šè¢«æ ‡è®°ä¸ºè„é¡µï¼Œä¸è¿‡åœ¨å†…å­˜ç¢ç‰‡æ•´ç†æ—¶ï¼Œå³ä½¿åŒ¿åé¡µè¢«æ ‡è®°ä¸ºè„é¡µä¹Ÿä¸ä¼šè¢«å›å†™ï¼Œå®ƒåªæœ‰åœ¨å†…å­˜å›æ”¶æ—¶æ‰ä¼šå¯¹è„åŒ¿åé¡µè¿›è¡Œå›å†™åˆ° swap åˆ†åŒºã€‚åœ¨è„åŒ¿åé¡µè¿›è¡Œå›å†™åˆ° swap åˆ†åŒºåï¼ŒåŸºæœ¬ä¸Šæ­¤åŒ¿åé¡µå ç”¨çš„é¡µæ¡†ä¹Ÿå¿«è¢«é‡Šæ”¾åˆ°ä¼™ä¼´ç³»ç»Ÿä¸­ä½œä¸ºç©ºé—²é¡µæ¡†äº†ã€‚</p><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* æè¿°å†…å­˜è§„æ•´å®Œæˆåçš„çŠ¶æ€ä¿¡æ¯</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   COMPACT_SKIPPED: è·³è¿‡æ­¤zoneï¼Œå¯èƒ½æ­¤zoneä¸é€‚åˆ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   COMPACT_DEFERRED: æ­¤zoneä¸èƒ½å¼€å§‹ï¼Œæ˜¯ç”±äºæ­¤zoneæœ€è¿‘å¤±è´¥è¿‡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   COMPACT_CONTINUE: ç»§ç»­å°è¯•åšpage compaction</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   COMPACT_COMPLETE: å¯¹æ•´ä¸ªzoneæ‰«æå·²ç»å®Œæˆï¼Œä½†æ˜¯æ²¡æœ‰è§„æ•´å‡ºåˆé€‚çš„é¡µ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   COMPACT_PARTIAL_SKIPPED: æ‰«æäº†éƒ¨åˆ†çš„zoneï¼Œä½†æ˜¯æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„é¡µ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   COMPACT_SUCCESS: è§„æ•´æˆåŠŸï¼Œå¹¶ä¸”åˆå¹¶å‡ºç©ºé—²çš„é¡µ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Return values for compact_zone() and try_to_compact_pages() */</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* When adding new states, please adjust include/trace/events/compaction.h */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> compact_result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/* For more detailed tracepoint output - internal to compaction */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	COMPACT_NOT_SUITABLE_ZONE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * compaction didn&#39;t start as it was not possible or direct reclaim</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * was more suitable</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	COMPACT_SKIPPED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/* compaction didn&#39;t start as it was deferred due to past failures */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	COMPACT_DEFERRED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/* For more detailed tracepoint output - internal to compaction */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	COMPACT_NO_SUITABLE_PAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/* compaction should continue to another pageblock */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	COMPACT_CONTINUE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * The full zone was compacted scanned but wasn&#39;t successful to compact</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * suitable pages.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	COMPACT_COMPLETE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * direct compaction has scanned part of the zone but wasn&#39;t successful</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * to compact suitable pages.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	COMPACT_PARTIAL_SKIPPED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/* compaction terminated prematurely due to lock contentions */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	COMPACT_CONTENDED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * direct compaction terminated after concluding that the allocation</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 * should now succeed</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	 */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	COMPACT_SUCCESS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><hr><p>æœ¯è¯­è§£é‡Šï¼š</p><ul><li>direct compaction: ä¸åŒäº kcompactd çš„</li><li>direct reclaim: ä¸åŒäº kswapd çš„ï¼Ÿ</li></ul><h2 id="æ ¸å¿ƒæµç¨‹" tabindex="-1">æ ¸å¿ƒæµç¨‹ <a class="header-anchor" href="#æ ¸å¿ƒæµç¨‹" aria-label="Permalink to â€œæ ¸å¿ƒæµç¨‹â€">â€‹</a></h2><p>ä»¥<a href="./buddy">buddy</a> system åˆ†é…å†…å­˜æ—¶è¿›å…¥æ…¢é€Ÿåˆ†é…æµç¨‹ä¸ºä¾‹ï¼Œ</p><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> page</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">__alloc_pages_slowpath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">gfp_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> gfp_mask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> order</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> alloc_context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ac</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  __alloc_pages_direct_compact</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> page</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">__alloc_pages_direct_compact</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  try_to_compact_pages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* å†…å­˜è§„æ•´æ ¸å¿ƒå‡½æ•°ï¼Œ3 ç§è§¦å‘æ–¹å¼æœ€åéƒ½ä¼šè°ƒç”¨è¯¥å‡½æ•° */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> compact_result</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> compact_zone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> compact_control</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> capture_control</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">capc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  migrate_pages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>ä»ä¸Šåˆ°ä¸‹</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>     å†…å­˜åˆ†é…</span></span>
<span class="line"><span>   compact reclaim</span></span>
<span class="line"><span>reclaim  migrate</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>migrate reclaim compact æ˜¯ä¸‰ä¸ªæ¯”è¾ƒå¤§çš„æ¨¡å—ï¼Œå…¶ä¸­å‰ä¸¤ä¸ªæ›´å¤§ï¼Œæœ‰æ›´å¤šæ¨¡å—ä¾èµ–ï¼Œè€Œ compact ä¾èµ–å‰ä¸¤ä¸ªã€‚ å…ˆä» migrate å’Œ reclaim å­¦èµ·ï¼Œ</p><p>å†…å­˜è§„æ•´æµç¨‹é‡Œï¼Œreclaim ä¼šæå‡æ°´çº¿ï¼Œä½†æœ€åè¿˜æ˜¯è¦ç”¨ get_page_from_freelist() ç”³è¯·å†…å­˜çš„ã€‚ åœ¨ get_page_from_freelist() é‡Œæ²¡ç”³è¯·åˆ°ä¼šå°è¯•å¿«é€Ÿå›æ”¶ï¼Œå¦‚æœè¿˜æ˜¯ä¸è¡Œï¼Œå°±è¿”å›ï¼Œåé¢å†å°è¯•ç›´æ¥å›æ”¶å•¥çš„ã€‚</p><h2 id="åˆ°ç›®å‰ä¸ºæ­¢çš„å˜åŠ¨" tabindex="-1">åˆ°ç›®å‰ä¸ºæ­¢çš„å˜åŠ¨ <a class="header-anchor" href="#åˆ°ç›®å‰ä¸ºæ­¢çš„å˜åŠ¨" aria-label="Permalink to â€œåˆ°ç›®å‰ä¸ºæ­¢çš„å˜åŠ¨â€">â€‹</a></h2><h2 id="è§¦å‘æ¡ä»¶" tabindex="-1">è§¦å‘æ¡ä»¶ <a class="header-anchor" href="#è§¦å‘æ¡ä»¶" aria-label="Permalink to â€œè§¦å‘æ¡ä»¶â€">â€‹</a></h2><ol><li>ä¼™ä¼´ç³»ç»Ÿåˆ†é…å†…å­˜ï¼Œè¿›å…¥æ…¢é€Ÿåˆ†é…æµç¨‹ <code>__alloc_pages_slowpath()</code>ï¼Œè‹¥é™ä½ watermak å€¼å’Œè¿›è¡Œ kswap å†…å­˜å›æ”¶æ“ä½œåï¼Œç³»ç»Ÿå†…å­˜ä»ç„¶åƒç´§ï¼Œåˆ™ä¼™ä¼´ç³»ç»Ÿä¼šè§¦å‘ memory-compactionã€‚</li><li>linux os å†…å­˜åƒç´§ï¼Œkcompactd çº¿ç¨‹å”¤é†’è§¦å‘ memory-compaction.</li><li>æ‰‹åŠ¨è§¦å‘ã€‚<code>echo 1 &gt; /sys/devices/system/node/nodexx/compact</code> æˆ– <code>echo 1 &gt; /proc/sys/vm/compact_memory</code></li></ol><h2 id="ä¸€äº›-patch" tabindex="-1">ä¸€äº› patch <a class="header-anchor" href="#ä¸€äº›-patch" aria-label="Permalink to â€œä¸€äº› patchâ€">â€‹</a></h2><ul><li><a href="https://lore.kernel.org/all/20160810091226.6709-1-vbabka@suse.cz/" target="_blank" rel="noreferrer">[PATCH v6 00/11] make direct compaction more deterministic - Vlastimil Babka</a></li><li><a href="https://lore.kernel.org/all/1407142524-2025-1-git-send-email-vbabka@suse.cz/" target="_blank" rel="noreferrer">[PATCH v6 00/13] compaction: balancing overhead and success rates - Vlastimil Babka</a></li></ul></div></div></main><footer class="VPDocFooter" data-v-d668f7cc data-v-1bcd8184><!--[--><!--]--><div class="edit-info" data-v-1bcd8184><div class="edit-link" data-v-1bcd8184><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/hyuuko1/blog/edit/main/mm/compaction.md" target="_blank" rel="noreferrer" data-v-1bcd8184><!--[--><span class="vpi-square-pen edit-link-icon" data-v-1bcd8184></span> Edit this page<!--]--></a></div><div class="last-updated" data-v-1bcd8184><p class="VPLastUpdated" data-v-1bcd8184 data-v-73dafb42>æœ€åæ›´æ–°äº: <time datetime="2025-11-23T15:44:07.000Z" data-v-73dafb42></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link prev" href="/blog/mm/anti-fragmentation" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>ä¸Šä¸€é¡µ</span><span class="title" data-v-1bcd8184>ğŸš§ å†…å­˜åç¢ç‰‡</span><!--]--></a></div><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link next" href="/blog/mm/page_migration" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>ä¸‹ä¸€é¡µ</span><span class="title" data-v-1bcd8184>é¡µé¢è¿ç§»</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-304c8b69 data-v-5b9946f5><div class="container" data-v-5b9946f5><p class="message" data-v-5b9946f5>Licensed under MIT</p><p class="copyright" data-v-5b9946f5>Copyright Â© 2024-2025 HYUUKO</p></div></footer><!--[--><!--]--></div></div>
    
    
  </body>
</html>