<!DOCTYPE html>
<html lang="zh-Hans" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TLB | Blog</title>
    <meta name="description" content="Linux kernel å†…æ ¸ä»£ç åˆ†æï¼ŒåŸç†è¯¦è§£">
    <meta name="generator" content="VitePress v2.0.0-alpha.13">
    <link rel="preload stylesheet" href="/blog/assets/style.Cg8D8EfQ.css" as="style">
    <link rel="preload stylesheet" href="/blog/vp-icons.css" as="style">
    <script type="module" src="/blog/assets/chunks/metadata.e2231c71.js"></script>
    <script type="module" src="/blog/assets/app.DgFSTuZM.js"></script>
    <link rel="preload" href="/blog/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/blog/assets/chunks/theme.3WDp7bvS.js">
    <link rel="modulepreload" href="/blog/assets/chunks/framework.CdzZEkix.js">
    <link rel="modulepreload" href="/blog/assets/mm_tlb.md.CXb0S26-.lean.js">
    <link rel="icon" type="image/svg+xml" href="/blog/linux.svg">
    <link rel="icon" type="image/png" href="/blog/linux-32x32.png">
    <meta name="theme-color" content="#5f67ee">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:title" content="TLB | Blog">
    <meta property="og:site_name" content="Linux kernel å†…æ ¸ä»£ç åˆ†æï¼ŒåŸç†è¯¦è§£">
    <meta property="og:url" content="https://hyuuko.vercel.app">
    <meta name="google-site-verification" content="OMML6xlbLb2Asitovo85pbOZGTvYoWaYWYW3ps7083s">
    <meta name="msvalidate.01" content="E3B108A75866D6C18B16BE35E14DE820">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-304c8b69><!--[--><!--]--><!--[--><span tabindex="-1" data-v-10d4d845></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-10d4d845>Skip to content</a><!--]--><!----><header class="VPNav" data-v-304c8b69 data-v-d5bf7c8e><div class="VPNavBar" data-v-d5bf7c8e data-v-8eab0e6d><div class="wrapper" data-v-8eab0e6d><div class="container" data-v-8eab0e6d><div class="title" data-v-8eab0e6d><div class="VPNavBarTitle has-sidebar" data-v-8eab0e6d data-v-d4488dd0><a class="title" href="/blog/" data-v-d4488dd0><!--[--><!--]--><!--[--><img class="VPImage logo" src="/blog/linux.svg" width="20" height="20" alt data-v-ab19afbb><!--]--><span data-v-d4488dd0>Blog</span><!--[--><!--]--></a></div></div><div class="content" data-v-8eab0e6d><div class="content-body" data-v-8eab0e6d><!--[--><!--]--><div class="VPNavBarSearch search" data-v-8eab0e6d><!--[--><!----><div id="local-search"><button type="button" aria-label="æœç´¢æ–‡æ¡£" aria-keyshortcuts="/ control+k meta+k" class="DocSearch DocSearch-Button"><span class="DocSearch-Button-Container"><span class="vpi-search DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">æœç´¢æ–‡æ¡£</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key"></kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-8eab0e6d data-v-020be4db><span id="main-nav-aria-label" class="visually-hidden" data-v-020be4db> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/blog/mm/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>å†…å­˜ç®¡ç†</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/net/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>ç½‘ç»œ</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/storage/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>å­˜å‚¨</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/process/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>è¿›ç¨‹</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/sched/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>è°ƒåº¦</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/irq/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>ä¸­æ–­</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/arch/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>ä½“ç³»ç»“æ„</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/debug/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>è°ƒè¯•</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/virtualization/index" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>è™šæ‹ŸåŒ–</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-020be4db data-v-d8fae6e2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-d8fae6e2><span class="text" data-v-d8fae6e2><!----><span data-v-d8fae6e2>æ‚é¡¹</span><span class="vpi-chevron-down text-icon" data-v-d8fae6e2></span></span></button><div class="menu" data-v-d8fae6e2><div class="VPMenu" data-v-d8fae6e2 data-v-fcd1d7a8><div class="items" data-v-fcd1d7a8><!--[--><!--[--><div class="VPMenuLink" data-v-fcd1d7a8 data-v-acfa8338><a class="VPLink link" href="/blog/other/index" data-v-acfa8338><!--[--><span data-v-acfa8338>å…¶ä»–</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fcd1d7a8 data-v-acfa8338><a class="VPLink link" href="/blog/init/index" data-v-acfa8338><!--[--><span data-v-acfa8338>åˆå§‹åŒ–</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fcd1d7a8 data-v-acfa8338><a class="VPLink link" href="/blog/pm/index" data-v-acfa8338><!--[--><span data-v-acfa8338>ç”µæºç®¡ç†</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-8eab0e6d data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-8eab0e6d data-v-ef6192dc data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/hyuuko1/blog" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-8eab0e6d data-v-600b50c9 data-v-d8fae6e2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-d8fae6e2><span class="vpi-more-horizontal icon" data-v-d8fae6e2></span></button><div class="menu" data-v-d8fae6e2><div class="VPMenu" data-v-d8fae6e2 data-v-fcd1d7a8><!----><!--[--><!--[--><!----><div class="group" data-v-600b50c9><div class="item appearance" data-v-600b50c9><p class="label" data-v-600b50c9>ä¸»é¢˜</p><div class="appearance-action" data-v-600b50c9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-600b50c9 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-600b50c9><div class="item social-links" data-v-600b50c9><div class="VPSocialLinks social-links-list" data-v-600b50c9 data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/hyuuko1/blog" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-8eab0e6d data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-8eab0e6d><div class="divider-line" data-v-8eab0e6d></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-304c8b69 data-v-5ae341c6><div class="container" data-v-5ae341c6><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-5ae341c6><span class="vpi-align-left menu-icon" data-v-5ae341c6></span><span class="menu-text" data-v-5ae341c6>èœå•</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-5ae341c6 data-v-e28a51a6><button data-v-e28a51a6>å›åˆ°é¡¶éƒ¨</button><!----></div></div></div><aside class="VPSidebar" data-v-304c8b69 data-v-46b39de1><div class="curtain" data-v-46b39de1></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-46b39de1><span class="visually-hidden" id="sidebar-aria-label" data-v-46b39de1> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å‰è¨€</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/update" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>æ›´æ–°è®¡åˆ’</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/gorman_book" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ UTLVMM (Linux 2.6)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>æè¿°ç‰©ç†å†…å­˜</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/layout" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>å†…å­˜å¸ƒå±€</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/e820" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>e820</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/node" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>node</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/zone" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>zone</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/folio" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>struct page/folio è¯¦è§£</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/vmemmap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>pfn_to_page() çš„åŸç†ï¼šmem_section ä¸ vmemmap</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible has-active" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>è™šæ‹Ÿå†…å­˜æ˜ å°„</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/rmap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>rmap åå‘æ˜ å°„</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/vma" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>vma</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/mmap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>mmap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/vmap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>vmap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/kmap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>kmap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/pagefault" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>page fault</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/page_table" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ page table</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/ioremap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ ioremap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/fixmap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ fixmap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/highmem" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ highmem é«˜ç«¯å†…å­˜</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/cow" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ CoW (Copy on Write)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/uffd" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ UFFD (userfaultfd)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/shmem" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ share memory</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/tlb" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ tlb</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/dma_buf" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ dma-buf</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å†…å­˜åˆ†é…</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/buddy" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Buddy System: é¡µé¢åˆ†é…å™¨</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/vmalloc" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>vmalloc: ä¸è¿ç»­ç‰©ç†å†…å­˜åˆ†é…</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/percpu" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>per-cpu é™æ€å’ŒåŠ¨æ€åˆ†é…</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/oom" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>OOM (Out Of Memory)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/slub" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>SLUB å†…å­˜åˆ†é…å™¨</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/cma" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>CMA è¿ç»­å†…å­˜åˆ†é…å™¨</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/memblock" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ æ—©æœŸå†…å­˜åˆ†é…å™¨ memblock</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/gfp" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>GFP (Get Free Page)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å¤§é¡µ</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/hugetlb" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>HugeTLB æ ‡å‡†å¤§é¡µ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/thp" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>THP (Transparent Huge Page) é€æ˜å¤§é¡µ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/mthp" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>mTHP (Multi-size Transparent Huge Page)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å†…å­˜å›æ”¶</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/reclaim/reclaim" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>å†…å­˜å›æ”¶(åºŸå¼ƒ)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/reclaim/basic" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>å†…å­˜å›æ”¶åŸºç¡€</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/reclaim/lru" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>LRU</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/reclaim/mglru" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>MGLRU</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/reclaim/workingset" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>workingset</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/reclaim/swap" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>swap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/mlock" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>mlock</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å†…å­˜åç¢ç‰‡</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/anti-fragmentation" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ å†…å­˜åç¢ç‰‡</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/compaction" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ å†…å­˜è§„æ•´</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/page_migration" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>é¡µé¢è¿ç§»</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å…¶ä»–</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/gup" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>GUP (Get User Page)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/pageflags" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>pageflags</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/madvise" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ madvise</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/ksm" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ KSM (Kernel Samepage Merging)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/hotplug" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ hotplug</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/virtio_mem" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ virtio mem</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/virtio_pmem" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ virtio pmem</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/virtio_balloon" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ virtio balloon</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Non-Uniform Memory Access architecture</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/mm/mempolicy" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ Memory Policy å†…å­˜ç­–ç•¥</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>å†…å­˜ç®¡ç†ä¸æ–‡ä»¶ç³»ç»Ÿ</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/storage/readahead" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ readahead é¢„è¯»</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/storage/pagecache" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ page cache</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/storage/page_writeback" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ page writeback</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/storage/tmpfs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ tmpfs</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/blog/storage/ramfs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ğŸš§ ramfs</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-304c8b69 data-v-2652e39a><div class="VPDoc has-sidebar has-aside" data-v-2652e39a data-v-d668f7cc><!--[--><!--]--><div class="container" data-v-d668f7cc><div class="aside" data-v-d668f7cc><div class="aside-curtain" data-v-d668f7cc></div><div class="aside-container" data-v-d668f7cc><div class="aside-content" data-v-d668f7cc><div class="VPDocAside" data-v-d668f7cc data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-c8b19031><div class="content" data-v-c8b19031><div class="outline-marker" data-v-c8b19031></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-c8b19031>ç›®å½•</div><ul class="VPDocOutlineItem root" data-v-c8b19031 data-v-63c57e50><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d668f7cc><div class="content-container" data-v-d668f7cc><!--[--><!--]--><main class="main" data-v-d668f7cc><div style="position:relative;" class="vp-doc _blog_mm_tlb external-link-icon-enabled" data-v-d668f7cc><div><h1 id="tlb" tabindex="-1">TLB <a class="header-anchor" href="#tlb" aria-label="Permalink to â€œTLBâ€">â€‹</a></h1><p><code>mm/mmu_gather.c</code></p><h2 id="ä½¿ç”¨æ¡ˆä¾‹" tabindex="-1">ä½¿ç”¨æ¡ˆä¾‹ <a class="header-anchor" href="#ä½¿ç”¨æ¡ˆä¾‹" aria-label="Permalink to â€œä½¿ç”¨æ¡ˆä¾‹â€">â€‹</a></h2><p>å¯¹äº kmalloc åŒºåŸŸçš„ï¼Œç›´æ¥ free_pages å³å¯ï¼Œä¸éœ€è¦ä¿®æ”¹é¡µè¡¨ã€‚ å¯¹äº vmalloc åŒºåŸŸçš„ï¼Œä»¥åŠç”¨æˆ·é¡µé¢ï¼Œå…¸å‹çš„å°±æ˜¯ç§æœ‰åŒ¿åæ˜ å°„é¡µé¢ï¼Œåœ¨é‡Šæ”¾å‰éœ€è¦æ”¹é¡µè¡¨çš„ï¼Œå°±éœ€è¦ç”¨åˆ°è¿™äº› API äº†ã€‚</p><p>ä¸€èˆ¬çš„ç”¨æ³•æµç¨‹æ˜¯ï¼š</p><ol><li><code>tlb_gather_mmu()</code> åˆå§‹åŒ– <code>struct mmu_gather</code></li><li><code>unmap_page_range()</code> ä¿®æ”¹é¡µè¡¨ï¼Œæ­¤æ—¶è¿˜æœª TLB flush</li><li><code>tlb_finish_mmu()</code> è¿›è¡Œ TLB invalidate å¹¶å°†é¡µé¢é‡Šæ”¾å› SLUB</li></ol><p>æ¡ˆä¾‹ï¼š</p><ul><li><a href="./oom"><code>__oom_reap_task_mm()</code></a> é‡Šæ”¾ç”¨æˆ·è¿›ç¨‹çš„ç§æœ‰åŒ¿åæ˜ å°„é¡µé¢</li><li><code>exit_mmap()</code></li></ul><h2 id="éƒ¨åˆ†ä»£ç åˆ†æ" tabindex="-1">éƒ¨åˆ†ä»£ç åˆ†æ <a class="header-anchor" href="#éƒ¨åˆ†ä»£ç åˆ†æ" aria-label="Permalink to â€œéƒ¨åˆ†ä»£ç åˆ†æâ€">â€‹</a></h2><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tlb_finish_mmu</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  tlb_flush_mmu</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    tlb_flush_mmu_tlbonly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tlb)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* TLB invalidate */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    tlb_flush_mmu_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      tlb_table_flush</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* TODO */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      tlb_batch_pages_flush</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* é‡Šæ”¾å’Œ swap cache */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        __tlb_batch_free_encoded_pages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">free_pages_and_swap_cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          free_swap_cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          folios_put_refs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">free_unref_folios</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">free_one_page</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* è¿™é‡Œé‡Šæ”¾çš„æ˜¯ struct mmu_gather_batch */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  tlb_batch_list_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">free_pages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="æ–‡æ¡£" tabindex="-1">æ–‡æ¡£ <a class="header-anchor" href="#æ–‡æ¡£" aria-label="Permalink to â€œæ–‡æ¡£â€">â€‹</a></h2><p>æ¥è‡ª <code>include/asm-generic/tlb.h</code> çš„æ³¨é‡Šã€‚</p><p>Generic MMU-gather implementation.</p><p>The <code>mmu_gather</code> data structure is used by the mm code to implement the correct and efficient ordering of freeing pages and TLB invalidations.</p><p>This correct ordering is:</p><ol><li>unhook page</li><li>TLB invalidate page</li><li>free page</li></ol><p>That is, we must never free a page before we have ensured there are no live translations left to it. Otherwise it might be possible to observe (or worse, change) the page content after it has been reused.</p><p>The mmu_gather API consists of:</p><ul><li><p><code>tlb_gather_mmu() / tlb_gather_mmu_fullmm() / tlb_finish_mmu()</code></p><p>start and finish a mmu_gather</p><p>Finish in particular will issue a (final) TLB invalidate and free all (remaining) queued pages.</p></li><li><p><code>tlb_start_vma() / tlb_end_vma()</code>; marks the start / end of a VMA</p><p>Defaults to flushing at <code>tlb_end_vma()</code> to reset the range; helps when there&#39;s large holes between the VMAs.</p></li><li><p><code>tlb_remove_table()</code></p><p><code>tlb_remove_table()</code> is the basic primitive to free page-table directories (<code>__p*_free_tlb()</code>). In it&#39;s most primitive form it is an alias for <code>tlb_remove_page()</code> below, for when page directories are pages and have no additional constraints.</p><p>See also <code>MMU_GATHER_TABLE_FREE</code> and <code>MMU_GATHER_RCU_TABLE_FREE</code>.</p></li><li><p><code>tlb_remove_page() / __tlb_remove_page()</code></p></li><li><p><code>tlb_remove_page_size() / __tlb_remove_page_size()</code></p></li><li><p><code>__tlb_remove_folio_pages()</code></p><p><code>__tlb_remove_page_size()</code> is the basic primitive that queues a page for freeing. <code>__tlb_remove_page()</code> assumes PAGE_SIZE. Both will return a boolean indicating if the queue is (now) full and a call to <code>tlb_flush_mmu()</code> is required.</p><p><code>tlb_remove_page()</code> and <code>tlb_remove_page_size()</code> imply the call to <code>tlb_flush_mmu()</code> when required and has no return value.</p><p><code>__tlb_remove_folio_pages()</code> is similar to <code>__tlb_remove_page()</code>, however, instead of removing a single page, remove the given number of consecutive pages that are all part of the same (large) folio: just like calling <code>__tlb_remove_page()</code> on each page individually.</p></li><li><p><code>tlb_change_page_size()</code></p><p>call before <code>__tlb_remove_page*()</code> to set the current page-size; implies a possible <code>tlb_flush_mmu()</code> call.</p></li><li><p><code>tlb_flush_mmu() / tlb_flush_mmu_tlbonly()</code></p><p><code>tlb_flush_mmu_tlbonly()</code> - does the TLB invalidate (and resets related state, like the range)</p><p><code>tlb_flush_mmu()</code> - in addition to the above TLB invalidate, also frees whatever pages are still batched.</p></li><li><p><code>mmu_gather::fullmm</code></p><p>A flag set by <code>tlb_gather_mmu_fullmm()</code> to indicate we&#39;re going to free the entire mm; this allows a number of optimizations.</p><ul><li><p>We can ignore <code>tlb_{start,end}_vma()</code>; because we don&#39;t care about ranges. Everything will be shot down.</p></li><li><p>(RISC) architectures that use ASIDs can cycle to a new ASID and delay the invalidation until ASID space runs out.</p></li></ul></li><li><p><code>mmu_gather::need_flush_all</code></p><p>A flag that can be set by the arch code if it wants to force flush the entire TLB irrespective of the range. For instance x86-PAE needs this when changing top-level entries.</p></li></ul><p>And allows the architecture to provide and implement <code>tlb_flush()</code>:</p><p><code>tlb_flush()</code> may, in addition to the above mentioned mmu_gather fields, make use of:</p><ul><li><p><code>mmu_gather::start / mmu_gather::end</code></p><p>which provides the range that needs to be flushed to cover the pages to be freed.</p></li><li><p><code>mmu_gather::freed_tables</code></p><p>set when we freed page table pages</p></li><li><p><code>tlb_get_unmap_shift() / tlb_get_unmap_size()</code></p><p>returns the smallest TLB entry size unmapped in this range.</p></li></ul><p>If an architecture does not provide <code>tlb_flush()</code> a default implementation based on <code>flush_tlb_range()</code> will be used, unless MMU_GATHER_NO_RANGE is specified, in which case we&#39;ll default to <code>flush_tlb_mm()</code>.</p><p>Additionally there are a few opt-in features:</p><ul><li><p><code>MMU_GATHER_PAGE_SIZE</code></p><p>This ensures we call <code>tlb_flush()</code> every time <code>tlb_change_page_size()</code> actually changes the size and provides mmu_gather::page_size to <code>tlb_flush()</code>.</p><p>This might be useful if your architecture has size specific TLB invalidation instructions.</p></li><li><p><code>MMU_GATHER_TABLE_FREE</code></p><p>This provides tlb_remove_table(), to be used instead of <code>tlb_remove_page()</code> for page directores (<code>__p*_free_tlb()</code>).</p><p>Useful if your architecture has non-page page directories.</p><p>When used, an architecture is expected to provide <code>__tlb_remove_table()</code> which does the actual freeing of these pages.</p></li><li><p><code>MMU_GATHER_RCU_TABLE_FREE</code></p><p>Like <code>MMU_GATHER_TABLE_FREE</code>, and adds semi-RCU semantics to the free (see comment below).</p><p>Useful if your architecture doesn&#39;t use IPIs for remote TLB invalidates and therefore doesn&#39;t naturally serialize with software page-table walkers.</p></li><li><p><code>MMU_GATHER_NO_FLUSH_CACHE</code></p><p>Indicates the architecture has <code>flush_cache_range()</code> but it needs <em>NOT</em> be called before unmapping a VMA.</p><p>NOTE: strictly speaking we shouldn&#39;t have this knob and instead rely on <code>flush_cache_range()</code> being a NOP, except Sparc64 seems to be different here.</p></li><li><p><code>MMU_GATHER_MERGE_VMAS</code></p><p>Indicates the architecture wants to merge ranges over VMAs; typical when multiple range invalidates are more expensive than a full invalidate.</p></li><li><p><code>MMU_GATHER_NO_RANGE</code></p><p>Use this if your architecture lacks an efficient flush_tlb_range(). This option implies <code>MMU_GATHER_MERGE_VMAS</code> above.</p></li><li><p><code>MMU_GATHER_NO_GATHER</code></p><p>If the option is set the mmu_gather will not track individual pages for delayed page free anymore. A platform that enables the option needs to provide its own implementation of the <code>__tlb_remove_page_size()</code> function to free pages.</p><p>This is useful if your architecture already flushes TLB entries in the various <code>ptep_get_and_clear()</code> functions.</p></li></ul></div></div></main><footer class="VPDocFooter" data-v-d668f7cc data-v-1bcd8184><!--[--><!--]--><div class="edit-info" data-v-1bcd8184><div class="edit-link" data-v-1bcd8184><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/hyuuko1/blog/edit/main/mm/tlb.md" target="_blank" rel="noreferrer" data-v-1bcd8184><!--[--><span class="vpi-square-pen edit-link-icon" data-v-1bcd8184></span> Edit this page<!--]--></a></div><div class="last-updated" data-v-1bcd8184><p class="VPLastUpdated" data-v-1bcd8184 data-v-73dafb42>æœ€åæ›´æ–°äº: <time datetime="2025-11-23T15:44:07.000Z" data-v-73dafb42></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link prev" href="/blog/mm/shmem" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>ä¸Šä¸€é¡µ</span><span class="title" data-v-1bcd8184>ğŸš§ share memory</span><!--]--></a></div><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link next" href="/blog/mm/dma_buf" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>ä¸‹ä¸€é¡µ</span><span class="title" data-v-1bcd8184>ğŸš§ dma-buf</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-304c8b69 data-v-5b9946f5><div class="container" data-v-5b9946f5><p class="message" data-v-5b9946f5>Licensed under MIT</p><p class="copyright" data-v-5b9946f5>Copyright Â© 2024-2025 HYUUKO</p></div></footer><!--[--><!--]--></div></div>
    
    
  </body>
</html>