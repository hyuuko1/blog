import{_ as i,c as a,o as n,al as e}from"./chunks/framework.CdzZEkix.js";const c=JSON.parse('{"title":"GFP (Get Free Page)","description":"","frontmatter":{"head":[["meta",{"property":"og:title","content":"GFP (Get Free Page) | Blog"}]]},"headers":[],"relativePath":"mm/gfp.md","filePath":"mm/gfp.md","lastUpdated":1763912647000}'),l={name:"mm/gfp.md"};function p(h,s,k,t,r,d){return n(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="gfp-get-free-page" tabindex="-1">GFP (Get Free Page) <a class="header-anchor" href="#gfp-get-free-page" aria-label="Permalink to â€œGFP (Get Free Page)â€">â€‹</a></h1><ul><li>ğŸŒŸ <a href="https://zhuanlan.zhihu.com/p/1921413069709485955" target="_blank" rel="noreferrer">Linux GFP Types</a></li></ul><p>æœ¬ç¯‡æ–‡ç« è®²è§£ä¼™ä¼´ç³»ç»Ÿåˆ†é…æ—¶çš„ flags å‚æ•°</p><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GFP_ATOMIC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">__GFP_HIGH</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">|__GFP_KSWAPD_RECLAIM)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GFP_KERNEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">__GFP_RECLAIM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> | __GFP_IO | __GFP_FS)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GFP_KERNEL_ACCOUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">GFP_KERNEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> | __GFP_ACCOUNT)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GFP_NOWAIT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">__GFP_KSWAPD_RECLAIM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> | __GFP_NOWARN)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GFP_NOIO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">__GFP_RECLAIM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GFP_NOFS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">__GFP_RECLAIM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> | __GFP_IO)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GFP_USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">__GFP_RECLAIM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> | __GFP_IO | __GFP_FS | __GFP_HARDWALL)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GFP_DMA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		__GFP_DMA</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GFP_DMA32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	__GFP_DMA32</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GFP_HIGHUSER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">GFP_USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> | __GFP_HIGHMEM)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GFP_HIGHUSER_MOVABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">GFP_HIGHUSER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> | __GFP_MOVABLE | __GFP_SKIP_KASAN)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GFP_TRANSHUGE_LIGHT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	((GFP_HIGHUSER_MOVABLE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> __GFP_COMP </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			 __GFP_NOMEMALLOC </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> __GFP_NOWARN) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__GFP_RECLAIM)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GFP_TRANSHUGE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">GFP_TRANSHUGE_LIGHT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> | __GFP_DIRECT_RECLAIM)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="gfp-zone-table" tabindex="-1"><code>GFP_ZONE_TABLE</code> <a class="header-anchor" href="#gfp-zone-table" aria-label="Permalink to â€œGFP_ZONE_TABLEâ€">â€‹</a></h2><h2 id="gfp-atomic" tabindex="-1"><code>GFP_ATOMIC</code> <a class="header-anchor" href="#gfp-atomic" aria-label="Permalink to â€œGFP_ATOMICâ€">â€‹</a></h2><p>åˆ†é…å†…å­˜æ—¶ï¼Œä¸ç¡çœ ã€‚</p><h2 id="gfp-nofs" tabindex="-1"><code>GFP_NOFS</code> <a class="header-anchor" href="#gfp-nofs" aria-label="Permalink to â€œGFP_NOFSâ€">â€‹</a></h2><ul><li><a href="https://docs.kernel.org/core-api/gfp_mask-from-fs-io.html" target="_blank" rel="noreferrer">GFP masks used from FS/IO context â€” The Linux Kernel documentation</a></li></ul><p>æ–‡ä»¶ç³»ç»Ÿå’Œ IO æ ˆä¸­çš„ä»£ç è·¯å¾„åœ¨åˆ†é…å†…å­˜æ—¶å¿…é¡»å°å¿ƒï¼Œä»¥é˜²æ­¢é€’å½’æ­»é”ã€‚ ä¼ ç»Ÿçš„æ–¹å¼æ˜¯åœ¨åˆ†é…å†…å­˜æ—¶ï¼Œä¼  <code>GFP_NOFS</code> å‚æ•°ï¼Œä¸å¸¸ç”¨çš„ <code>GFP_KERNEL</code> ç›¸æ¯”ï¼Œå®ƒæ¸…é™¤äº† <code>__GFP_FS</code>ã€‚</p><p><code>__GFP_FS</code> è¡¨æ˜å…è®¸è°ƒç”¨æ–‡ä»¶ç³»ç»Ÿçš„ä»£ç ã€‚ä¾‹å¦‚ï¼Œåœ¨ <code>super_cache_scan()</code> é‡Œï¼Œå¦‚æœæ£€æŸ¥åˆ°äº†æ²¡æœ‰ <code>__GFP_FS</code> flagï¼Œåˆ™ä¼šæ‹’ç»ç»§ç»­æ‰§è¡Œï¼Œé˜²æ­¢å‘ç”Ÿæ­»é”ã€‚</p><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> long</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> super_cache_scan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> shrinker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">shrink</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> shrink_control</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   * Deadlock avoidance.  We may hold various FS locks, and we don&#39;t want</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   * to recurse into the FS that called us in clear_inode() and friends..</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sc-&gt;gfp_mask </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> __GFP_FS))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SHRINK_STOP;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ... åé¢å¯èƒ½ä¼šåŠ é”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>GFP_NOFS</code> å’Œ <code>GFP_NOIO</code> æœ‰æ»¥ç”¨çš„æƒ…å†µï¼Œå°±å¼•å…¥äº†è¿™å‡ ä¸ª scope API å®šä¹‰ä¸€ä¸ªä½œç”¨åŸŸï¼Œåœ¨è¯¥ä½œç”¨åŸŸå†…ï¼Œå†…å­˜åˆ†é…æ“ä½œä¸ä¼šé€’å½’å› FS/IOã€‚</p><ul><li><code>memalloc_nofs_save</code></li><li><code>memalloc_nofs_restore</code></li><li><code>memalloc_noio_save</code></li><li><code>memalloc_noio_restore</code></li></ul><p>å‡ ä¸ªæ­»é”çš„ä¾‹å­ï¼š</p><ul><li><a href="https://lore.kernel.org/all/20200414150233.24495-16-willy@infradead.org/" target="_blank" rel="noreferrer">[PATCH v11 15/25] mm: Use memalloc_nofs_save in readahead path - Matthew Wilcox</a></li><li><a href="https://lore.kernel.org/all/20240426112938.124740-1-wangkefeng.wang@huawei.com/" target="_blank" rel="noreferrer">[PATCH] mm: use memalloc_nofs_save() in page_cache_ra_order() - Kefeng Wang</a></li><li><a href="https://lore.kernel.org/linux-mm/ZRdNK39vc4TuR7g8@casper.infradead.org/" target="_blank" rel="noreferrer">Removal of KM_NOFS - Matthew Wilcox</a></li></ul><p>ä»åˆ†é…å†…å­˜åˆ° <code>super_cache_scan()</code> çš„ä»£ç è·¯å¾„ï¼š</p><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* åœ¨ memalloc_nofs_save çš„ä½œç”¨åŸŸåˆ†é…å†…å­˜æ—¶ï¼Œè°ƒç”¨åˆ° super_cache_scan æ—¶ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   æ˜¯æ²¡æœ‰ __GFP_FS çš„ */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__alloc_pages_noprof-&gt;__alloc_pages_slowpath-&gt;__alloc_pages_direct_reclaim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  try_to_free_pages</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sc.gfp_mask </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> current_gfp_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(gfp_mask),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pflags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> READ_ONCE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(current-&gt;flags);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (pflags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PF_MEMALLOC_NOFS)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* memalloc_nofs_save ä¼šè®¾ç½®æ­¤ flag */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__GFP_FS;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* ç§»é™¤ __GFP_FS */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    do_try_to_free_pages-&gt;shrink_zones-&gt;shrink_node-&gt;shrink_node_memcgs-&gt;shrink_slab</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      do_shrink_slab-&gt;scan_objects:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">super_cache_scan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="gfp-noio" tabindex="-1"><code>GFP_NOIO</code> <a class="header-anchor" href="#gfp-noio" aria-label="Permalink to â€œGFP_NOIOâ€">â€‹</a></h2><p>ä¸ <code>GFP_NOFS</code> ç±»ä¼¼</p><h2 id="gfp-movable" tabindex="-1"><code>__GFP_MOVABLE</code> <a class="header-anchor" href="#gfp-movable" aria-label="Permalink to â€œ__GFP_MOVABLEâ€">â€‹</a></h2><p>å‡½æ•° <code>gfp_migratetype()</code> ç”¨æ¥æŠŠ gfp_flags è½¬æ¢æˆè¿ç§»ç±»å‹</p><ul><li>ä½¿ç”¨æ ‡å¿— <code>__GFP_MOVABLE</code> æŒ‡å®šç”³è¯·å¯ç§»åŠ¨é¡µ <code>MIGRATE_MOVABLE</code></li><li>ä½¿ç”¨æ ‡å¿— <code>__GFP_RECLAIMABLE</code> æŒ‡å®šç”³è¯·å¯å›æ”¶é¡µ <code>MIGRATE_RECLAIMABLE</code></li><li>å¦‚æœæ²¡æœ‰æŒ‡å®šè¿™ä¸¤ä¸ªæ ‡å¿—ï¼Œè¡¨ç¤ºç”³è¯·ä¸å¯ç§»åŠ¨é¡µ <code>MIGRATE_UNMOVABLE</code></li></ul><p><code>__GFP_MOVABLE</code> æœ‰ä¸¤ä¸ªä½œç”¨</p><ol><li>å’Œ <code>__GFP_HIGHMEM</code> ç»„åˆè¡¨ç¤ºä»å¯ç§»åŠ¨åŒºåŸŸåˆ†é…ç‰©ç†é¡µã€‚</li><li>åœ¨æ ¹æ®å¯ç§»åŠ¨æ€§åˆ†ç»„æŠ€æœ¯ä¸­è¡¨ç¤ºç”³è¯·è¿ç§»ç±»å‹æ˜¯å¯ç§»åŠ¨ç±»å‹çš„ç‰©ç†é¡µ <code>MIGRATE_MOVABLE</code>ï¼ˆå°½å¯èƒ½åœ°ä»è¿™é‡Œç”³è¯·ï¼Œå¯èƒ½ä¼šä»å…¶ä»–ç±»å‹çš„è¿›è¡Œ stealï¼‰</li></ol><h2 id="gfp-reclaimable" tabindex="-1"><code>__GFP_RECLAIMABLE</code> <a class="header-anchor" href="#gfp-reclaimable" aria-label="Permalink to â€œ__GFP_RECLAIMABLEâ€">â€‹</a></h2><p>å½“ä½¿ç”¨ <code>__GFP_RECLAIMABLE</code> æ ‡å¿—è¿›è¡Œå†…å­˜åˆ†é…æ—¶ï¼Œè¡¨ç¤ºï¼šâ€œæˆ‘åˆ†é…çš„é¡µé¢æ˜¯å¯å›æ”¶çš„ï¼Œå¦‚æœç³»ç»Ÿå†…å­˜ç´§å¼ ï¼Œå¯ä»¥å°†å…¶å›æ”¶ã€‚â€</p><p>ä¸»è¦ç”¨äº slab åˆ†é…å™¨ä¸­é‚£äº›æŒ‡å®šäº† <code>SLAB_RECLAIM_ACCOUNT</code> çš„å†…å­˜åˆ†é…ï¼ˆæ¯”å¦‚ sock_inode_cacheï¼‰ï¼Œè¡¨æ˜è¿™äº›é¡µé¢å¯ä»¥é€šè¿‡ shrinker æœºåˆ¶è¢«é‡Šæ”¾ã€‚</p><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kvfree_rcu_init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  kfree_rcu_shrinker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> shrinker_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;slab-kvfree-rcu&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  kfree_rcu_shrinker-&gt;count_objects </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kfree_rcu_shrink_count;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  kfree_rcu_shrinker-&gt;scan_objects </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kfree_rcu_shrink_scan;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">do_shrink_slab</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  count_objects:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kfree_rcu_shrink_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  scan_objects:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kfree_rcu_shrink_scan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div>`,29)])])}const _=i(l,[["render",p]]);export{c as __pageData,_ as default};
